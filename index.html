<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BebCom Delivery</title>

    <style>
        /* ====== ESTILOS GERAIS ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #f5f5f5;
            min-height: 100vh;
            padding-bottom: 20px;
        }

        .header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            text-align: center;
            padding: 25px 20px;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative;
            border-bottom: 2px solid #dc2626;
        }

            .header::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f, #4d96ff);
            }

        .nav-container {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            overflow-x: auto;
            border-bottom: 1px solid #333;
        }

        .nav-button {
            padding: 12px 20px;
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid #333;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

            .nav-button:hover {
                background: rgba(220, 38, 38, 0.8);
                transform: translateY(-2px);
            }

        .main-container {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .menu-section {
            flex: 3;
            background: rgba(26, 26, 26, 0.9);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
        }

        .cart-section {
            flex: 2;
            background: rgba(26, 26, 26, 0.9);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }

        .section-title {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .category-button {
            background: linear-gradient(135deg, rgba(45, 45, 45, 0.9) 0%, rgba(60, 60, 60, 0.9) 100%);
            border: 1px solid #333;
            padding: 25px 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
            text-align: center;
        }

            .category-button:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px rgba(220, 38, 38, 0.2);
                border-color: #dc2626;
            }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: rgba(45, 45, 45, 0.7);
            border: 1px solid #444;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

            .product-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 20px rgba(220, 38, 38, 0.15);
                border-color: #dc2626;
            }

            .product-card.unavailable {
                opacity: 0.5;
                pointer-events: none;
            }

                .product-card.unavailable::after {
                    content: "INDISPON√çVEL";
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(220, 38, 38, 0.9);
                    color: white;
                    padding: 8px 16px;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: bold;
                    z-index: 2;
                }

            .product-card.with-flavors {
                border-left: 4px solid #4d96ff;
            }

        .product-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #f5f5f5;
        }

        .product-info {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 16px;
            color: #dc2626;
            font-weight: bold;
            text-align: center;
        }

        .flavor-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(77, 150, 255, 0.2);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #4d96ff;
        }

        .add-to-cart-btn {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

            .add-to-cart-btn.has-flavors {
                background: linear-gradient(135deg, #4d96ff 0%, #3b82f6 100%);
            }

            .add-to-cart-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3);
            }

            .add-to-cart-btn.has-flavors:hover {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                box-shadow: 0 5px 15px rgba(77, 150, 255, 0.3);
            }

            .add-to-cart-btn.added {
                background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            }

            .add-to-cart-btn:disabled {
                background: #666;
                cursor: not-allowed;
                opacity: 0.7;
                transform: none !important;
                box-shadow: none !important;
            }

        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(45, 45, 45, 0.5);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #444;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

            .quantity-btn:hover {
                background: rgba(255, 255, 255, 0.2);
            }

        .remove-item-btn {
            background: none;
            border: none;
            color: #ff6b6b;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            padding: 4px 8px;
            border-radius: 4px;
        }

            .remove-item-btn:hover {
                background: rgba(255, 107, 107, 0.1);
            }

        .totals-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }

        .grand-total {
            font-size: 20px;
            font-weight: bold;
            color: #ffd93d;
            border-bottom: none;
            padding-top: 10px;
            border-top: 2px solid #444;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #ddd;
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .address-grid {
            display: grid;
            grid-template-columns: 1fr 100px;
            gap: 10px;
            margin-bottom: 10px;
        }

        .delivery-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .delivery-option {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: rgba(45, 45, 45, 0.5);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

            .delivery-option:hover {
                background: rgba(45, 45, 45, 0.8);
            }

            .delivery-option.selected {
                border-color: #4d96ff;
                background: rgba(77, 150, 255, 0.1);
            }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-method {
            padding: 15px;
            background: rgba(45, 45, 45, 0.5);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

            .payment-method:hover {
                background: rgba(45, 45, 45, 0.8);
            }

            .payment-method.selected {
                border-color: #4d96ff;
                background: rgba(77, 150, 255, 0.1);
            }

        .payment-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .primary-button {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

            .primary-button:hover:not(:disabled) {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
            }

            .primary-button:disabled {
                background: #666;
                cursor: not-allowed;
                opacity: 0.7;
            }

        .secondary-button {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

            .secondary-button:hover:not(:disabled) {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(37, 211, 102, 0.4);
            }

            .secondary-button:disabled {
                background: #666;
                cursor: not-allowed;
                opacity: 0.7;
            }

        .clear-button {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

            .clear-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
            }

        .payment-status {
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            background: rgba(255, 217, 61, 0.1);
            border-left: 4px solid #ffd93d;
            font-size: 14px;
            text-align: center;
            animation: slideIn 0.3s ease;
        }

            .payment-status.success {
                background: rgba(107, 207, 127, 0.1);
                border-left-color: #6bcf7f;
            }

            .payment-status.error {
                background: rgba(220, 38, 38, 0.1);
                border-left-color: #dc2626;
            }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        /* MODAL PARA SELE√á√ÉO DE SABORES (REUTILIZ√ÅVEL) */
        .flavor-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 20000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .flavor-modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid #4d96ff;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .flavor-modal-title {
            color: #4d96ff;
            text-align: center;
            font-size: 22px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .flavors-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .flavor-option {
            padding: 18px 12px;
            background: rgba(45, 45, 45, 0.6);
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 15px;
            font-weight: 500;
        }

            .flavor-option:hover {
                background: rgba(77, 150, 255, 0.2);
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(77, 150, 255, 0.3);
            }

            .flavor-option.selected {
                border-color: #ffd93d;
                background: rgba(255, 217, 61, 0.1);
                font-weight: bold;
            }

            .flavor-option.unavailable {
                opacity: 0.5;
                pointer-events: none;
                position: relative;
                cursor: not-allowed;
            }

                .flavor-option.unavailable::after {
                    content: "INDISPON√çVEL";
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(220, 38, 38, 0.9);
                    color: white;
                    padding: 5px 10px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: bold;
                    z-index: 2;
                }

        .modal-instruction {
            text-align: center;
            color: #aaa;
            font-size: 14px;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .modal-button {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

            .modal-button.confirm {
                background: linear-gradient(135deg, #28a745 0%, #218838 100%);
                color: white;
            }

                .modal-button.confirm:hover:not(:disabled) {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
                }

            .modal-button.cancel {
                background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
                color: white;
            }

                .modal-button.cancel:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
                }

            .modal-button:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none !important;
                box-shadow: none !important;
            }

        /* ====== SISTEMA ADMINISTRATIVO ====== */
        .admin-button {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            transition: all 0.3s ease;
        }

            .admin-button:hover {
                transform: scale(1.1);
                background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            }

        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10001;
            overflow-y: auto;
            padding: 20px;
        }

        .admin-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            max-width: 1000px;
            margin: 40px auto;
            border-radius: 15px;
            border: 2px solid #3b82f6;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .admin-header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            padding: 20px 30px;
            border-bottom: 2px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 24px;
            font-weight: bold;
            color: #60a5fa;
        }

        .admin-close {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-password {
            padding: 30px;
            background: rgba(26, 26, 26, 0.8);
            border-bottom: 1px solid #333;
        }

        .password-input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .password-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
        }

        .admin-main {
            padding: 20px 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .admin-category-section {
            margin-bottom: 25px;
            background: rgba(26, 26, 26, 0.5);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #333;
        }

        .admin-category-title {
            font-size: 18px;
            font-weight: bold;
            color: #60a5fa;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3b82f6;
        }

        .admin-product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .admin-product-item {
            background: rgba(45, 45, 45, 0.3);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #444;
            transition: all 0.3s ease;
        }

            .admin-product-item:hover {
                border-color: #3b82f6;
                background: rgba(59, 130, 246, 0.1);
            }

        .admin-product-name {
            color: #f5f5f5;
            font-size: 16px;
            font-weight: bold;
        }

        .admin-product-price {
            color: #dc2626;
            font-size: 14px;
            margin-top: 5px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #dc2626;
            transition: .4s;
            border-radius: 30px;
        }

            .toggle-slider:before {
                position: absolute;
                content: "";
                height: 22px;
                width: 22px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }

        .toggle-checkbox:checked + .toggle-slider {
            background-color: #10b981;
        }

            .toggle-checkbox:checked + .toggle-slider:before {
                transform: translateX(30px);
            }

        .admin-actions {
            padding: 20px 30px;
            background: rgba(26, 26, 26, 0.8);
            border-top: 1px solid #333;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .admin-action-btn {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-align: center;
        }

        .save-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .reset-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .all-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .none-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .export-btn {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .admin-help {
            color: #94a3b8;
            font-size: 12px;
            margin-top: 10px;
            text-align: center;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ====== MODAL DE VERIFICA√á√ÉO DE IDADE ====== */
        .age-verification-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 99999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .age-modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            border-radius: 15px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid #dc2626;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: modalAgeAppear 0.6s ease;
        }

        @keyframes modalAgeAppear {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .age-modal-header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            padding: 25px 30px;
            border-bottom: 2px solid #dc2626;
            text-align: center;
        }

            .age-modal-header h2 {
                color: #fff;
                font-size: 28px;
                margin: 0;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            }

        .age-modal-body {
            padding: 30px;
        }

        .age-warning-icon {
            font-size: 60px;
            text-align: center;
            margin-bottom: 20px;
            color: #ffd93d;
        }

        .age-legal-text {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 10px;
            border-left: 4px solid #3b82f6;
            margin-bottom: 20px;
        }

            .age-legal-text p, .age-legal-text li {
                color: #ddd;
                line-height: 1.6;
                margin-bottom: 15px;
                font-size: 15px;
            }

            .age-legal-text strong {
                color: #fff;
            }

            .age-legal-text ol {
                padding-left: 20px;
                margin: 15px 0;
            }

                .age-legal-text ol li {
                    margin-bottom: 10px;
                }

        .age-checkbox-container {
            background: rgba(220, 38, 38, 0.1);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dc2626;
            margin-top: 25px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

            .age-checkbox-container input[type="checkbox"] {
                width: 22px;
                height: 22px;
                margin-top: 3px;
                accent-color: #28a745;
                cursor: pointer;
            }

            .age-checkbox-container label {
                color: #fff;
                line-height: 1.5;
                cursor: pointer;
                font-size: 15px;
            }

        .age-modal-footer {
            padding: 20px 30px;
            display: flex;
            gap: 20px;
            border-top: 1px solid #333;
            background: rgba(26, 26, 26, 0.8);
        }

        .age-btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

            .age-btn small {
                font-size: 12px;
                font-weight: normal;
                opacity: 0.8;
            }

        .age-btn-exit {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
        }

            .age-btn-exit:hover {
                background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
            }

        .age-btn-enter {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: white;
        }

            .age-btn-enter:hover:not(:disabled) {
                background: linear-gradient(135deg, #218838 0%, #1e7e34 100%);
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
            }

            .age-btn-enter:disabled {
                background: #666;
                cursor: not-allowed;
                opacity: 0.7;
                transform: none !important;
                box-shadow: none !important;
            }

        .age-modal-disclaimer {
            padding: 15px 30px;
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid #333;
            text-align: center;
            color: #94a3b8;
            font-size: 12px;
            line-height: 1.4;
        }

        /* ====== CORRE√á√ïES PARA ADMIN NO MOBILE ====== */
        @media (max-width: 768px) {
            .admin-modal {
                padding: 10px !important;
            }

            .admin-content {
                margin: 10px auto !important;
                max-height: 90vh !important;
                overflow-y: auto !important;
            }

            .admin-header {
                padding: 15px 20px !important;
                flex-direction: column !important;
                gap: 15px !important;
            }

            .admin-main {
                padding: 15px 20px !important;
                max-height: 50vh !important;
            }

            .admin-category-section {
                padding: 15px !important;
            }

            .admin-product-item {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 15px !important;
            }

            .toggle-switch {
                align-self: flex-end !important;
            }

            #flavorsList > div {
                grid-template-columns: 1fr !important;
            }

            .flavor-option {
                padding: 20px 15px !important;
                font-size: 16px !important;
            }

            .flavor-modal-overlay {
                align-items: flex-start !important;
                padding-top: 20px !important;
                padding-bottom: 20px !important;
            }

            .flavor-modal-content {
                width: 95% !important;
                max-height: 85vh !important;
                padding: 20px !important;
                margin-top: 20px !important;
                margin-bottom: 20px !important;
            }

            .flavors-grid {
                grid-template-columns: 1fr !important;
            }

            .flavor-option.unavailable {
                opacity: 0.7 !important;
            }

                .flavor-option.unavailable::after {
                    font-size: 12px !important;
                    padding: 6px 12px !important;
                    position: relative !important;
                    top: auto !important;
                    left: auto !important;
                    transform: none !important;
                    display: block !important;
                    margin-top: 10px !important;
                    width: 100% !important;
                }

            .modal-buttons {
                flex-direction: column !important;
            }

            .modal-button {
                width: 100% !important;
            }
        }

        @media (max-width: 480px) {
            .admin-button {
                width: 45px !important;
                height: 45px !important;
                font-size: 20px !important;
                top: 10px !important;
                right: 10px !important;
            }

            .admin-content {
                border-radius: 10px !important;
            }

            .admin-category-title {
                font-size: 16px !important;
            }

            .admin-product-name {
                font-size: 14px !important;
            }

            .flavor-modal-title {
                font-size: 18px !important;
            }

            .modal-instruction {
                font-size: 13px !important;
                padding: 8px !important;
            }
        }

        .product-card.unavailable::after {
            font-size: 14px !important;
            padding: 10px 20px !important;
            text-align: center;
            white-space: normal !important;
            max-width: 90% !important;
        }

        .flavor-option.unavailable::after {
            font-size: 12px !important;
            padding: 8px 16px !important;
            text-align: center;
            white-space: normal !important;
            max-width: 90% !important;
        }

        .admin-main,
        .flavor-modal-content,
        .age-modal-content {
            -webkit-overflow-scrolling: touch !important;
        }

        @media (max-width: 768px) {
            .age-modal-content {
                max-width: 95%;
            }

            .age-modal-header h2 {
                font-size: 22px;
            }

            .age-modal-footer {
                flex-direction: column;
            }

            .age-legal-text {
                padding: 15px;
            }

            .age-btn {
                padding: 15px;
                font-size: 16px;
            }
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }

            .cart-section {
                position: static;
                max-height: none;
            }

            .admin-product-grid {
                grid-template-columns: 1fr;
            }

            .admin-action-btn {
                min-width: 150px;
            }
        }

        @media (max-width: 768px) {
            .categories-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .payment-methods {
                grid-template-columns: 1fr;
            }

            .address-grid {
                grid-template-columns: 1fr;
            }

            .flavors-grid {
                grid-template-columns: 1fr;
            }

            .admin-actions {
                flex-direction: column;
            }

            .admin-action-btn {
                min-width: 100%;
            }

            .nav-container {
                padding: 10px;
            }

            .nav-button {
                padding: 10px 15px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .header {
                font-size: 20px;
                padding: 20px 10px;
            }

            .section-title {
                font-size: 20px;
            }

            .flavor-modal-content {
                padding: 20px;
            }

            .modal-buttons {
                flex-direction: column;
            }

            .age-modal-header {
                padding: 20px 15px;
            }

            .age-modal-body {
                padding: 20px 15px;
            }

            .age-legal-text {
                font-size: 14px;
            }

            .age-modal-footer {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Bot√£o Admin -->
    <button class="admin-button" id="adminButton" title="Painel Administrativo">
        üîß
    </button>

    <!-- MODAL DE VERIFICA√á√ÉO DE IDADE -->
    <div class="age-verification-modal" id="ageVerificationModal">
        <div class="age-modal-content">
            <div class="age-modal-header">
                <h2>üçπ Verifica√ß√£o de Idade BebCom Delivery</h2>
            </div>

            <div class="age-modal-body">
                <div class="age-warning-icon">‚ö†Ô∏è</div>

                <div class="age-legal-text">
                    <p><strong>DECLARA√á√ÉO LEGAL E TERMOS DE ACESSO</strong></p>

                    <p>Conforme disposto no <strong>artigo 243, ¬ß1¬∫ do Estatuto da Crian√ßa e do Adolescente (Lei 8.069/90)</strong> e no <strong>artigo 81 do C√≥digo de Defesa do Consumidor (Lei 8.078/90)</strong>, a venda e o fornecimento de bebidas alco√≥licas a menores de 18 (dezoito) anos constituem infra√ß√µes sujeitas √†s penalidades legais, incluindo multas e responsabiliza√ß√£o civil e penal.</p>

                    <p>O <strong>BebCom Delivery</strong>, em estrita observ√¢ncia √† legisla√ß√£o brasileira, adota os seguinte protocolos:</p>

                    <ol>
                        <li><strong>Verifica√ß√£o de Idade Obrigat√≥ria:</strong> Este site √© destinado exclusivamente a maiores de 18 anos;</li>
                        <li><strong>Responsabilidade do Consumidor:</strong> Ao prosseguir, voc√™ declara, sob as penas da lei, que possui idade igual ou superior a 18 anos;</li>
                        <li><strong>Verifica√ß√£o na Entrega:</strong> Reservamo-nos o direito de solicitar documento de identifica√ß√£o com foto no momento da entrega/retirada, recusando o servi√ßo em caso de n√£o comprova√ß√£o da maioridade;</li>
                        <li><strong>Consumo Respons√°vel:</strong> Recomendamos o consumo moderado de bebidas alco√≥licas. O abuso pode cause depend√™ncia qu√≠mica e prejudicar sua sa√∫de.</li>
                    </ol>

                    <p><strong>Art. 243, ¬ß1¬∫ do ECA:</strong> "Vender, fornecer ainda que gratuitamente ou entregar, de qualquer forma, a crian√ßa ou adolescente, sem justa causa, produtos cujos componentes possam causar depend√™ncia f√≠sica ou ps√≠quica, ainda que por utiliza√ß√£o indevida: Pena - deten√ß√£o de 2 (dois) a 4 (quatro) anos, e multa."</p>

                    <div class="age-checkbox-container">
                        <input type="checkbox" id="ageConfirmationCheckbox">
                        <label for="ageConfirmationCheckbox">
                            <strong>DECLARO SOB AS PENAS DA LEI</strong> que tenho 18 anos ou mais, estou ciente das disposi√ß√µes legais acima e assumo total responsabilidade pela veracidade desta declara√ß√£o.
                        </label>
                    </div>
                </div>
            </div>

            <div class="age-modal-footer">
                <button class="age-btn age-btn-exit" onclick="exitSite()">
                    ‚ùå Sair do Site
                    <small>Menor de 18 anos</small>
                </button>
                <button class="age-btn age-btn-enter" id="enterSiteButton" onclick="enterSite()" disabled>
                    ‚úÖ Entrar no Site
                    <small>Sou maior de 18 anos</small>
                </button>
            </div>

            <div class="age-modal-disclaimer">
                <small>BebCom Delivery - CNPJ: XX.XXX.XXX/XXXX-XX | Respons√°vel: [Nome do Respons√°vel Legal] | Este site utiliza cookies para melhorar sua experi√™ncia.</small>
            </div>
        </div>
    </div>

    <div class="header">
        üçπ BEBCOM DELIVERY üçπ
    </div>

    <div class="nav-container">
        <button class="nav-button" onclick="showCategory('drinks-whisky')">üç∏ Drinks Whisky</button>
        <button class="nav-button" onclick="showCategory('drinks-gin')">üç∏ Drinks Gin</button>
        <button class="nav-button" onclick="showCategory('drinks-vodka')">üç∏ Drinks Vodka</button>
        <button class="nav-button" onclick="showCategory('drinks-vinho')">üç∏ Drinks Vinho</button>
        <button class="nav-button" onclick="showCategory('cervejas')">üç∫ Cervejas</button>
        <button class="nav-button" onclick="showCategory('destilados')">ü•É Destilados</button>
        <button class="nav-button" onclick="showCategory('aguas')">ü•§ √Åguas</button>
        <button class="nav-button" onclick="showCategory('refri-latas')">ü•§ Refri Latas</button>
        <button class="nav-button" onclick="showCategory('refri-pet')">ü•§ Refri PET</button>
        <button class="nav-button" onclick="showCategory('sucos')">üßÉ Sucos</button>
        <button class="nav-button" onclick="showCategory('energeticos')">‚ö° Energ√©ticos</button>
        <button class="nav-button" onclick="showCategory('gelo-carvao')">üßä Gelo/Carv√£o</button>
    </div>

    <div class="main-container">
        <!-- SE√á√ÉO DO CARD√ÅPIO -->
        <div class="menu-section">
            <h2 class="section-title"> Card√°pio BebCom </h2>

            <!-- Categorias -->
            <div class="categories-grid" id="categoriesGrid"></div>

            <!-- Produtos -->
            <div class="products-grid" id="productsGrid">
                <div style="text-align: center; color: #aaa; padding: 40px;">
                    Selecione uma categoria para ver os produtos
                </div>
            </div>
        </div>

        <!-- SE√á√ÉO DO CARRINHO -->
        <div class="cart-section">
            <h2 class="section-title">üõí Carrinho</h2>

            <div class="cart-items" id="cartItems">
                <div style="text-align: center; color: #aaa; padding: 40px;">
                    Seu carrinho est√° vazio<br><small>Adicione produtos do card√°pio</small>
                </div>
            </div>

            <!-- Totais -->
            <div class="totals-section">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span>R$ <span id="subtotal">0.00</span></span>
                </div>
                <div class="total-row" id="deliveryRow" style="display: none;">
                    <span>Taxa de Entrega:</span>
                    <span>R$ <span id="deliveryFee">0.00</span></span>
                </div>
                <div class="total-row grand-total">
                    <span>Total:</span>
                    <span>R$ <span id="totalAmount">0.00</span></span>
                </div>
            </div>

            <!-- Dados do Cliente -->
            <div class="customer-section">
                <div class="form-group">
                    <label class="form-label">üë§ Nome Completo *</label>
                    <input type="text" class="form-input" id="customerName" placeholder="Digite seu nome" required>
                </div>
                <div class="form-group">
                    <label class="form-label">üìû WhatsApp *</label>
                    <input type="tel" class="form-input" id="customerPhone" placeholder="(14) 99999-9999" required>
                </div>
            </div>

            <!-- Tipo de Pedido -->
            <div class="delivery-section">
                <label class="form-label">üì¶ Tipo de Pedido</label>
                <div class="delivery-options">
                    <div class="delivery-option selected" onclick="selectDeliveryType('pickup')">üè™ Retirada</div>
                    <div class="delivery-option" onclick="selectDeliveryType('delivery')">üöö Entrega</div>
                </div>

                <!-- Campos de Endere√ßo -->
                <div id="addressFields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">üìç Endere√ßo Completo *</label>
                        <div class="address-grid">
                            <input type="text" class="form-input" id="street" placeholder="Rua/Avenida">
                            <input type="text" class="form-input" id="number" placeholder="N√∫mero">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="address-grid">
                            <input type="text" class="form-input" id="neighborhood" placeholder="Bairro">
                            <input type="text" class="form-input" id="city" placeholder="Cidade" value="Bauru">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üè† Complemento (opcional)</label>
                        <input type="text" class="form-input" id="addressComplement" placeholder="Apto, Bloco, Refer√™ncia">
                    </div>
                </div>
            </div>

            <!-- Pagamento -->
            <div class="payment-section">
                <label class="form-label" id="paymentLabel" style="display: none;">üí≥ Pagamento</label>
                <div class="payment-methods" id="paymentMethods" style="display: none;">
                    <div class="payment-method selected" onclick="selectPaymentMethod('pix')">
                        <div class="payment-icon">üßæ</div>
                        <div>PIX Online</div>
                    </div>
                    <div class="payment-method" onclick="selectPaymentMethod('card_online')">
                        <div class="payment-icon">üí≥</div>
                        <div>Cart√£o Online</div>
                    </div>
                </div>

                <!-- Status do Pagamento -->
                <div id="paymentStatus" class="payment-status" style="display: none;"></div>

                <!-- Bot√µes de A√ß√£o -->
                <button class="primary-button" id="payButton" disabled onclick="processPayment()">
                    üí∞ Realizar Pagamento
                </button>

                <button class="secondary-button" id="whatsappButton" disabled onclick="sendToWhatsApp()">
                    üì± Enviar Pedido
                </button>

                <button class="clear-button" onclick="clearCart()">
                    üóëÔ∏è Limpar Carrinho
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL REUTILIZ√ÅVEL PARA SELE√á√ÉO DE SABORES -->
    <div class="flavor-modal-overlay" id="flavorModal">
        <div class="flavor-modal-content">
            <h2 class="flavor-modal-title" id="flavorModalTitle">Escolha o sabor</h2>
            <div class="modal-instruction" id="flavorModalInstruction">
                Selecione uma op√ß√£o para continuar
            </div>

            <div class="flavors-grid" id="flavorsGrid">
                <!-- Os sabores ser√£o gerados dinamicamente -->
            </div>

            <div class="modal-buttons">
                <button class="modal-button confirm" id="confirmFlavorButton" onclick="confirmFlavorSelection()">
                    ‚úÖ Confirmar
                </button>
                <button class="modal-button cancel" onclick="cancelFlavorSelection()">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL ADMINISTRATIVO -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-content">
            <div class="admin-header">
                <h2 class="admin-title">üîß Gerenciamento de Produtos - BebCom Delivery</h2>
                <button class="admin-close" id="adminClose">√ó</button>
            </div>

            <!-- Tela de Senha -->
            <div class="admin-password" id="passwordSection">
                <h3 style="color: #60a5fa; margin-bottom: 20px; text-align: center;">üîê Acesso Administrativo</h3>
                <input type="password" class="password-input" id="adminPassword" placeholder="Digite a senha administrativa">
                <button class="password-button" onclick="checkAdminPassword()">Entrar</button>
                <p class="admin-help">
                    (Ctrl+Alt+A para abrir rapidamente)
                </p>
            </div>

            <!-- Painel Principal -->
            <div class="admin-main" id="adminMain" style="display: none;">
                <div class="admin-category-section">
                    <h3 class="admin-category-title">ü•É Drinks Whisky</h3>
                    <div class="admin-product-grid" id="adminWhiskyProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">üç∏ Drinks Gin</h3>
                    <div class="admin-product-grid" id="adminGinProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">üç∏ Drinks Vodka</h3>
                    <div class="admin-product-grid" id="adminVodkaProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">üç∏ Drinks Vinho</h3>
                    <div class="admin-product-grid" id="adminVinhoProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">üç∫ Cervejas</h3>
                    <div class="admin-product-grid" id="adminCervejaProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">ü•É Destilados</h3>
                    <div class="admin-product-grid" id="adminDestiladoProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">ü•§ √Åguas</h3>
                    <div class="admin-product-grid" id="adminAguaProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">ü•§ Refri Latas</h3>
                    <div class="admin-product-grid" id="adminRefriLataProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">ü•§ Refri PET</h3>
                    <div class="admin-product-grid" id="adminRefriPetProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">üßÉ Sucos</h3>
                    <div class="admin-product-grid" id="adminSucoProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">‚ö° Energ√©ticos</h3>
                    <div class="admin-product-grid" id="adminEnergeticoProducts"></div>
                </div>

                <div class="admin-category-section">
                    <h3 class="admin-category-title">üßä Gelo/Carv√£o</h3>
                    <div class="admin-product-grid" id="adminGeloProducts"></div>
                </div>
            </div>

            <div class="admin-actions" id="adminActions" style="display: none;">
                <button class="admin-action-btn all-btn" onclick="setAllAvailable(true)">
                    ‚úÖ Marcar Todos Dispon√≠vel
                </button>
                <button class="admin-action-btn none-btn" onclick="setAllAvailable(false)">
                    ‚ùå Marcar Todos Indispon√≠vel
                </button>
                <button class="admin-action-btn save-btn" onclick="saveAvailability()">
                    üíæ Salvar Altera√ß√µes
                </button>
                <button class="admin-action-btn reset-btn" onclick="resetAvailability()">
                    üîÑ Restaurar Padr√£o
                </button>
                <button class="admin-action-btn export-btn" onclick="exportOrder()">
                    üìÅ Exportar Pedidos
                </button>
                <button class="admin-action-btn" onclick="openFlavorManagement()"
                        style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    üçπ Gerenciar Sabores
                </button>
                <button class="admin-action-btn" onclick="syncAllFromServer()"
                        style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); margin-top: 10px;">
                    üîÑ Sincronizar Agora
                </button>
                <button class="admin-action-btn" onclick="showSyncStatus()"
                        style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); margin-top: 10px;">
                    üìä Status da Sincroniza√ß√£o
                </button>
                <button class="admin-action-btn" onclick="showBackendStatus()"
                        style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); margin-top: 10px;">
                    üì° Status do Backend
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // FUN√á√ïES DE VERIFICA√á√ÉO DE IDADE
        // ============================================

        // Vari√°vel para controle do modal de idade
        let ageVerified = false;

        // Fun√ß√£o para inicializar o modal de idade
        function initAgeVerification() {
            const hasConfirmedAge = localStorage.getItem('bebcom_age_verified');

            // ‚úÖ Se j√° confirmou antes, entra direto e inicializa o app
            if (hasConfirmedAge === 'true') {
                state.ageVerified = true;

                const modal = document.getElementById('ageVerificationModal');
                if (modal) modal.style.display = 'none';

                document.body.style.overflow = 'auto';

                // ‚úÖ Inicializa o sistema principal
                initUserInterface();
                return;
            }

            // Caso N√ÉO tenha confirmado idade ainda
            document.getElementById('ageVerificationModal').style.display = 'flex';

            const checkbox = document.getElementById('ageConfirmationCheckbox');
            const enterButton = document.getElementById('enterSiteButton');

            checkbox.addEventListener('change', function () {
                enterButton.disabled = !this.checked;
            });

            enterButton.addEventListener('click', enterSite);

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && !state.ageVerified) {
                    e.preventDefault();
                    exitSite();
                }
            });

            document.body.style.overflow = 'hidden';
        }

        // Fun√ß√£o para entrar no site
        function enterSite() {
            ageVerified = true;
            state.ageVerified = true;
            localStorage.setItem('bebcom_age_verified', 'true');
            document.getElementById('ageVerificationModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            showNotification('‚úÖ Acesso permitido. Aproveite nosso card√°pio com responsabilidade!');
            
            // Inicializa o aplicativo ap√≥s confirmar idade
            initUserInterface();
        }

        // Fun√ß√£o para sair do site (menor de idade)
        function exitSite() {
            // Redirecionar para uma p√°gina apropriada ou mostrar mensagem
            document.body.innerHTML = `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    text-align: center;
                    padding: 20px;
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                ">
                    <div style="font-size: 80px; margin-bottom: 20px;">üö´</div>
                    <h1 style="font-size: 32px; margin-bottom: 20px; color: #dc2626;">Acesso Restrito</h1>
                    <p style="font-size: 18px; max-width: 600px; line-height: 1.6; margin-bottom: 30px;">
                        Conforme a legisla√ß√£o brasileira (Estatuto da Crian√ßa e do Adolescente - Lei 8.069/90),
                        o acesso a sites de venda de bebidas alco√≥licas √© restrito a maiores de 18 anos.
                    </p>
                    <p style="font-size: 16px; color: #aaa; max-width: 600px; line-height: 1.5;">
                        O BebCom Delivery segue rigorosamente as normas legais para proteger menores de idade
                        e promover o consumo respons√°vel de bebidas alco√≥licas.
                    </p>
                    <div style="margin-top: 40px;">
                        <button onclick="window.location.href='https://www.google.com'" style="
                            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
                            color: white;
                            border: none;
                            padding: 15px 30px;
                            border-radius: 8px;
                            font-size: 16px;
                            cursor: pointer;
                            font-weight: bold;
                        ">
                            Voltar para a navega√ß√£o segura
                        </button>
                    </div>
                    <div style="margin-top: 50px; font-size: 12px; color: #666;">
                        BebCom Delivery ¬© ${new Date().getFullYear()} - Todos os direitos reservados
                    </div>
                </div>
            `;
        }

        // ============================================
        // CONFIGURA√á√ïES DO SISTEMA (SEGURO - SEM CHAVES SENS√çVEIS)
        // ============================================
        const CONFIG = {
            // üîí ATEN√á√ÉO: Substitua esta URL pela URL do seu backend no Render
            backendUrl: 'https://bebcom-cardapio-delivery.onrender.com',

            whatsappNumber: '5514996130369',

            storeLocation: {
                lat: -22.35892,
                lng: -49.0987233,
                address: "R. Jos√© Henrique Ferraz, 18-10 - Centro, Bauru - SP"
            },

            deliveryRates: {
                baseFee: 5.00,
                perKm: 2.65,
                maxDistance: 15,
                minDistance: 0.5,
                freeDeliveryMin: 100.00
            },

            // üîí SENHA ADMINISTRATIVA - Altere para uma senha forte!
            adminPassword: 'Bebcom25*'
        };

        // ============================================
        // DADOS DOS PRODUTOS ATUALIZADOS (COMPLETO)
        // ============================================
        const products = {
            'drinks-whisky': [
                {
                    id: 'old-star',
                    name: 'Cop√£o Old Star',
                    description: 'Drink cl√°ssico de whisky',
                    price: 11.00,
                    requiresFlavorSelection: true,
                    flavorType: 'whisky_oldstar',
                    nextStep: 'ice'
                },
                {
                    id: 'passport',
                    name: 'Cop√£o Passport',
                    description: 'Whisky importado',
                    price: 18.00,
                    requiresFlavorSelection: false,
                    flavorType: null
                },
                {
                    id: 'natu-nobilis',
                    name: 'Cop√£o Natu Nobilis',
                    description: 'Whisky premium',
                    price: 17.00,
                    requiresFlavorSelection: false,
                    flavorType: null
                },
                {
                    id: 'white-horse',
                    name: 'Cop√£o White Horse',
                    description: 'Whisky escoc√™s',
                    price: 22.00,
                    requiresFlavorSelection: false,
                    flavorType: null
                },
                {
                    id: 'red-label',
                    name: 'Cop√£o Red Label',
                    description: 'Johnnie Walker Red Label',
                    price: 25.00,
                    requiresFlavorSelection: false,
                    flavorType: null
                },
                {
                    id: 'ballantines',
                    name: 'Cop√£o Ballantines',
                    description: 'Whisky escoc√™s',
                    price: 28.00,
                    requiresFlavorSelection: false,
                    flavorType: null
                },
                {
                    id: 'jack-daniels',
                    name: 'Cop√£o Jack Daniels',
                    description: 'Whisky americano',
                    price: 35.00,
                    requiresFlavorSelection: true,
                    flavorType: 'whisky_jack',
                    nextStep: 'ice'
                }
            ],
            'drinks-gin': [
                {
                    id: 'danoninho-gin',
                    name: 'Danoninho de Gin',
                    description: 'Batida com Gin',
                    price: 18.00,
                    requiresFlavorSelection: true,
                    flavorType: 'gin_sabores',
                    nextStep: 'ice'
                },
                {
                    id: 'copa-gin',
                    name: 'Cop√£o de Gin',
                    description: 'Drink com Gin Askov Sabores',
                    price: 18.00,
                    requiresFlavorSelection: true,
                    flavorType: 'gin_sabores',
                    nextStep: 'ice'
                }
            ],
            'drinks-vodka': [
                {
                    id: 'danoninho-corote',
                    name: 'Danoninho Corote',
                    description: 'Batida com Corote',
                    price: 15.00,
                    requiresFlavorSelection: true,
                    flavorType: 'corote_sabores'
                },
                {
                    id: 'danoninho-askov',
                    name: 'Danoninho Askov',
                    description: 'Askov de frutas com leite condensado',
                    price: 18.00,
                    requiresFlavorSelection: true,
                    flavorType: 'vodka_sabores'
                }
            ],
            'drinks-vinho': [
                {
                    id: 'danoninho-vinho',
                    name: 'Danoninho de Vinho',
                    description: 'Batida de Cantinho do Valle com leite condensado',
                    price: 18.00,
                    requiresFlavorSelection: false
                }
            ],
            'cervejas': [
                { id: 'brahma', name: 'Brahma', description: 'Cerveja tradicional brasileira', price: 4.25 },
                { id: 'skol', name: 'Skol', description: 'Cerveja tradicional brasileira', price: 4.25 },
                { id: 'antarctica', name: 'Antarctica', description: 'Cerveja pilsen refrescante', price: 4.25 },
                { id: 'sub-zero', name: 'Sub-Zero', description: 'Cerveja extra gelada', price: 4.25 },
                { id: 'amstel', name: 'Amstel', description: 'Cerveja holandesa premium', price: 4.00 },
                { id: 'heineken', name: 'Heineken', description: 'Cerveja importada premium', price: 6.50 },
                { id: 'corona-long', name: 'Corona Long', description: 'Cerveja mexicana em long neck', price: 8.50 },
                { id: 'stella-long', name: 'Stella Long', description: 'Cerveja belga em long neck', price: 7.50 },
                { id: 'brahma-zero', name: 'Brahma Zero', description: 'Cerveja sem √°lcool', price: 5.00 },
                { id: 'imperio', name: 'Imperio', description: 'Cerveja brasileira tradicional', price: 3.75 },
                { id: 'duplo-malte', name: 'Duplo Malte', description: 'Cerveja com duplo malte', price: 5.00 },
                { id: 'spaten', name: 'Spaten', description: 'Cerveja alem√£ premium', price: 5.50 },
                { id: 'budweiser', name: 'Budweiser', description: 'Cerveja americana', price: 5.50 },
                { id: 'burguesa', name: 'Burguesa', description: 'Cerveja artesanal brasileira', price: 3.75 },
                { id: 'bavaria', name: 'Bavaria', description: 'Cerveja holandesa', price: 3.25 },
                { id: 'bavaria-latao', name: 'Bavaria Lat√£o', description: 'Cerveja em lata grande', price: 4.75 },
                { id: 'petra', name: 'Petra', description: 'Cerveja brasileira', price: 4.00 },
                { id: 'conti-malzbier', name: 'Conti Malzbier', description: 'Cerveja tipo malzbier', price: 4.50 },
                { id: 'brahma-malz', name: 'Brahma Malz.', description: 'Malzbier da Brahma', price: 4.50 },
                { id: 'moinho-real', name: 'Moinho Real', description: 'Cerveja brasileira', price: 4.00 },
                { id: 'original', name: 'Original', description: 'Cerveja premium', price: 5.50 },
                { id: 'heineken-long', name: 'Heineken Long', description: 'Heineken em long neck', price: 8.50 },
                { id: 'budweiser-long', name: 'Budweiser Long', description: 'Budweiser em long neck', price: 8.00 },
                { id: 'eisenbah-ipa', name: 'Eisenbah IPA', description: 'Cerveja IPA artesanal', price: 8.50 },
                { id: 'stella-gold', name: 'Stella Gold', description: 'Stella Artois premium', price: 8.00 },
                { id: 'amstel-ultra-long', name: 'Amstel Ultra Long', description: 'Cerveja leve em long neck', price: 6.50 },
                { id: 'amstel-ultra', name: 'Amstel Ultra', description: 'Cerveja leve', price: 5.00 },
                { id: 'spaten-long', name: 'Spaten Long', description: 'Spaten em long neck', price: 7.50 },
                { id: 'imperio-gold', name: 'Imp√©rio Gold', description: 'Cerveja premium brasileira', price: 8.00 },
                { id: 'michelob-long', name: 'Michelob Long', description: 'Michelob em long neck', price: 7.50 },
                { id: 'michelob', name: 'Michelob', description: 'Cerveja americana premium', price: 6.00 },
                { id: 'conti-zero-grau', name: 'Conti Zero Grau', description: 'Cerveja com √°lcool', price: 3.00 }
            ],
            'destilados': [
                { id: 'tequila', name: 'Tequila', description: 'Destilado mexicano', price: 23.00 },
                { id: 'pinga-51', name: 'Pinga 51', description: 'Cacha√ßa brasileira', price: 19.00 },
                { id: 'conhaque', name: 'Conhaque', description: 'Destilado envelhecido', price: 19.00 },
                { id: 'dimel', name: 'Dimel', description: 'Licor italiano', price: 30.00 },
                { id: 'campari', name: 'Campari', description: 'Bitter italiano', price: 65.00 },
                {
                    id: 'gin-askov',
                    name: 'Gin Askov',
                    description: 'Gin brasileiro',
                    price: 20.00,
                    requiresFlavorSelection: true,
                    flavorType: 'gin_sabores'
                },
                { id: 'askov-pura', name: 'Askov Pura', description: 'Vodka brasileira pura', price: 20.00 },
                {
                    id: 'askov-ice',
                    name: 'Askov Ice',
                    description: 'Bebida ready to drink',
                    price: 8.00,
                    requiresFlavorSelection: true,
                    flavorType: 'ice_askov'
                },
                {
                    id: 'ice-leev',
                    name: 'Ice Leev',
                    description: 'Bebida ready to drink',
                    price: 8.00,
                    requiresFlavorSelection: true,
                    flavorType: 'ice_leev'
                },
                {
                    id: 'beats-lata',
                    name: 'Beats Lata',
                    description: 'Bebida em lata',
                    price: 7.50,
                    requiresFlavorSelection: true,
                    flavorType: 'beats'
                },
                { id: 'beats-long', name: 'Beats Long', description: 'Bebida Sense em long neck', price: 9.00 },
                { id: 'smirnoff-ice', name: 'Smirnoff Ice', description: 'Bebida de lim√£o com vodka', price: 10.00 },
                { id: 'velho-barreiro', name: 'Velho Barreiro', description: 'Cacha√ßa tradicional', price: 19.00 },
                { id: 'jack-daniels-dest', name: 'Jack Daniels', description: 'Whiskey americano', price: 200.00 },
                { id: 'white-horse-dest', name: 'White Horse', description: 'Whisky escoc√™s', price: 97.50 },
                { id: 'red-label-dest', name: 'Red Label', description: 'Johnnie Walker', price: 140.00 },
                { id: 'ballantines-dest', name: 'Ballantines', description: 'Whisky escoc√™s', price: 135.00 },
                { id: 'smirnoff-1l', name: 'Smirnoff 1L', description: 'Vodka premium 1 litro', price: 56.00 },
                {
                    id: 'askov-sabor-1l',
                    name: 'Askov Sabor 1L',
                    description: 'Vodka com sabor 1 litro',
                    price: 20.00,
                    requiresFlavorSelection: true,
                    flavorType: 'vodka_sabores'
                },
                { id: 'canelinha', name: 'Canelinha', description: 'Canelinha da Rocha', price: 25.00 },
                { id: 'dom-bosco', name: 'Dom Bosco', description: 'Vinho brasileiro', price: 20.00 },
                { id: 'chapinha', name: 'Chapinha', description: 'Vinho brasileira', price: 15.00 },
                { id: 'pergola', name: 'P√©rgola', description: 'Licor premium', price: 35.00 },
                { id: 'dom-feliciano', name: 'Dom Feliciano', description: 'Licor ga√∫cho', price: 20.00 },
                { id: 'cantinho-do-valle', name: 'Cantinho do Valle', description: 'Bebida ready to drink', price: 8.00 },
                { id: 'stempel-355ml', name: 'Stempel 355ml', description: 'Cerveja artesanal em garrafa', price: 8.00 },
                { id: 'stempel-600ml', name: 'Stempel 600ml', description: 'Cerveja artesanal 600ml', price: 12.00 }
            ],
            'aguas': [
                { id: 'agua-500ml', name: '√Ågua 500ml', description: '√Ågua mineral natural', price: 3.00 },
                { id: 'agua-1.5l', name: '√Ågua 1,5L', description: '√Ågua mineral fam√≠lia', price: 6.00 },
                { id: 'agua-coco-1l', name: '√Ågua de Coco 1L', description: '√Ågua de coco natural', price: 12.00 },
                { id: 'agua-gas-500ml', name: '√Ågua G√°s 500ml', description: '√Ågua com g√°s', price: 3.50 },
                { id: 'agua-gas-1.5l', name: '√Ågua G√°s 1,5L', description: '√Ågua com g√°s fam√≠lia', price: 7.00 },
                {
                    id: 'h2o-500ml',
                    name: 'H2O 500ml',
                    description: '√Ågua mineral premium',
                    price: 5.00,
                    requiresFlavorSelection: true,
                    flavorType: 'h2o_sabores'
                },
                {
                    id: 'h2o-1.5l',
                    name: 'H2O 1,5L',
                    description: '√Ågua premium fam√≠lia',
                    price: 10.00,
                    requiresFlavorSelection: true,
                    flavorType: 'h2o_sabores'
                },
                { id: 'gatorade', name: 'Gatorade', description: 'Bebida isot√¥nica', price: 8.00 }
            ],
            'refri-latas': [
                { id: 'fanta-laranja', name: 'Fanta Laranja', description: 'Refrigerante c√≠trico', price: 4.50 },
                { id: 'guarana-antarctica', name: 'Guaran√° Antarctica', description: 'Refrigerante brasileiro', price: 4.50 },
                { id: 'pepsi-black', name: 'Pepsi Black', description: 'Refrigerante de cola', price: 4.50 },
                { id: 'coca-cola-lata', name: 'Coca Cola', description: 'Refrigerante tradicional', price: 4.50 },
                { id: 'schwepps', name: 'Schwepps', description: 'Refrigerante t√¥nico', price: 5.00 },
                { id: 'tonica-antarctica', name: 'T√¥nica Antarctica', description: 'Refrigerante t√¥nico', price: 4.50 },
                { id: 'coca-zero-lata', name: 'Coca Cola Zero', description: 'Refrigerante sem a√ß√∫car', price: 4.50 },
                { id: 'sprite-zero-lata', name: 'Sprite Zero', description: 'Refrigerante c√≠trico sem a√ß√∫car', price: 4.50 }
            ],
            'refri-pet': [
                { id: 'coca-2l', name: 'Coca-Cola 2L', description: 'Refrigerante fam√≠lia', price: 13.00 },
                { id: 'sprite-2l', name: 'Sprite 2L', description: 'Refrigerante c√≠trico', price: 11.00 },
                { id: 'fanta-laranja-2l', name: 'Fanta Laranja 2L', description: 'Refrigerante laranja', price: 11.00 },
                { id: 'coca-mini', name: 'Coca Mini', description: 'Coca-Cola pequena', price: 3.00 },
                { id: 'conq-mini', name: 'Conq. Mini', description: 'Conquista mini', price: 2.50 },
                { id: 'coca-600ml', name: 'Coca 600ml', description: 'Coca-Cola 600ml', price: 7.00 },
                { id: 'coca-600ml-zero', name: 'Coca 600ml Zero', description: 'Coca-Cola Zero 600ml', price: 7.00 },
                { id: 'coca-1l', name: 'Coca-Cola 1L', description: 'Coca-Cola 1 litro', price: 9.00 },
                { id: 'coca-1l-zero', name: 'Coca-Cola 1L Zero', description: 'Coca-Cola Zero 1 litro', price: 9.00 },
                { id: 'sprite-600ml', name: 'Sprite 600ml', description: 'Sprite 600ml', price: 6.00 },
                { id: 'schwepps-1.5l', name: 'Schwepps 1,5L', description: 'Refrigerante c√≠trico premium', price: 10.50 },
                { id: 'guarana-2l', name: 'Ant√°rctica 2L', description: 'Guaran√° Antarctica 2 litros', price: 12.00 },
                { id: 'guarana-2l-zero', name: 'Ant√°rctica 2L Zero', description: 'Guaran√° Antarctica Zero 2 litros', price: 12.00 },
                { id: 'guarana-1l', name: 'Ant√°rctica 1L', description: 'Guaran√° Antarctica 1 litro', price: 9.00 },
                { id: 'conquista-2l', name: 'Conquista 2L', description: 'Guaran√° Conquista 2 litros', price: 8.50 },
                { id: 'quinze-2l', name: 'Quinze 2L', description: 'Guaran√° Quinze 2 litros', price: 7.00 },
                { id: 'conti-2l', name: 'Conti 2L', description: 'Refrigerante Cola 2 litros', price: 8.50 },
                { id: 'guarana-mini', name: 'Guaran√° Mini', description: 'Guaran√° Antarctica individual', price: 3.00 }
            ],
            'sucos': [
                {
                    id: 'del-valle-1l',
                    name: 'Del Valle 1L',
                    description: 'Suco de caixinha',
                    price: 12.00,
                    requiresFlavorSelection: true,
                    flavorType: 'suco_delvalle'
                },
                { id: 'prats-300ml-laranja', name: 'Prats 300ml Laranja', description: 'Suco de laranja', price: 6.00 },
                {
                    id: 'kapo',
                    name: 'Kapo',
                    description: 'Suco em p√≥',
                    price: 4.00,
                    requiresFlavorSelection: true,
                    flavorType: 'suco_kapo'
                },
                { id: 'prats-1.5l-laranja', name: 'Prats 1,5L Laranja', description: 'Suco de laranja fam√≠lia', price: 23.00 },
                {
                    id: 'life-900ml',
                    name: 'Life 900ml',
                    description: 'Suco premium',
                    price: 14.00,
                    requiresFlavorSelection: true,
                    flavorType: 'suco_life'
                }
            ],
            'energeticos': [
                { id: 'big-power-2l', name: 'Big Power 2L', description: 'Energ√©tico grande', price: 13.00 },
                {
                    id: 'monster-473ml',
                    name: 'Monster 473ml',
                    description: 'Energ√©tico importado',
                    price: 12.00,
                    requiresFlavorSelection: true,
                    flavorType: 'energetico_monster'
                },
                { id: 'red-bull-250ml', name: 'Red Bull Tradicional 250ml', description: 'Energ√©tico pequeno', price: 14.00 },
                {
                    id: 'bally-2l',
                    name: 'Bally 2L',
                    description: 'Energ√©tico 2 litros',
                    price: 15.00,
                    requiresFlavorSelection: true,
                    flavorType: 'energetico_bally'
                },
                {
                    id: 'bally-473ml',
                    name: 'Bally 473ml',
                    description: 'Energ√©tico lata grande',
                    price: 10.00,
                    requiresFlavorSelection: true,
                    flavorType: 'energetico_bally'
                }
            ],
            'gelo-carvao': [
                {
                    id: 'gelo-saborizado',
                    name: 'Gelo Saborizado',
                    description: 'Gelo com sabor',
                    price: 3.00,
                    requiresFlavorSelection: true,
                    flavorType: 'gelo_sabores'
                },
                { id: 'carvao-3kg', name: 'Carv√£o 3kg', description: 'Carv√£o para churrasco', price: 20.00 },
                { id: 'gelo-4.5kg', name: 'Gelo 4,5Kg', description: 'Gelo em saco', price: 11.00 },
                { id: 'carvao-6kg', name: 'Carv√£o 6Kg', description: 'Carv√£o grande', price: 30.00 }
            ]
        };

        // ============================================
        // CAT√ÅLOGO DE SABORES POR TIPO
        // ============================================
        const FLAVOR_CATALOG = {
            'whisky_oldstar': [
                'Old Star Tradicional',
                'Old Star Ma√ß√£-Verde'
            ],
            'whisky_jack': [
                'Jack Tradicional',
                'Jack Mel',
                'Jack Ma√ß√£-Verde'
            ],
            'gin_sabores': [
                'Tropical',
                'Melancia',
                'Morango',
                'Ma√ß√£-Verde'
            ],
            'corote_sabores': [
                'Morango',
                'Mel√¢ncia',
                'Maracuj√°',
                'P√™ssego',
                'Blueberry',
                'Lim√£o',
                'Canelinha'
            ],
            'vodka_sabores': [
                'Frutas Vermelhas',
                'Maracuj√°',
                'Frutas Roxas',
                'Kiwi',
                'P√™ssego',
                'Lim√£o',
                'Blueberry'
            ],
            'ice_askov': [
                'Maracuj√°',
                'Lim√£o',
                'Frutas Vermelhas',
                'Pina Colada'
            ],
            'ice_leev': [
                'Morango',
                'Lim√£o',
                'Mel√¢ncia',
                'Maracuj√°',
                'Abacaxi com Hortel√£',
                'Ma√ß√£-Verde'
            ],
            'beats': [
                'Sense',
                'GT',
                'Red Mix',
                'Green Mix'
            ],
            'h2o_sabores': [
                'Lim√£o',
                'Limoneto'
            ],
            'suco_delvalle': [
                'Laranja',
                'Manga',
                'Maracuj√°',
                'Caju (sem a√ß√∫car)',
                'Uva',
                'P√™ssego'
            ],
            'suco_kapo': [
                'Uva',
                'Morango',
                'Maracuj√°',
                'Laranja'
            ],
            'suco_life': [
                'Uva',
                'Laranja'
            ],
            'energetico_monster': [
                'Tradicional',
                'Tradicional Zero',
                'Uva',
                'Mango Loco',
                'Melancia',
                'Mango Loco Zero',
                'Ultra Monster',
                'Absolut',
                'Cereja',
                'P√™ssego',
                'Rio',
                'Laranja'
            ],
            'energetico_bally': [
                'Tradicional',
                'Morango e P√™ssego',
                'Melancia',
                'Tropical'
            ],
            'gelo_sabores': [
                'Melancia',
                'Morango',
                'Lim√£o',
                'C√¥co',
                'Ma√ß√£-Verde',
                'Abacaxi com Hortel√£',
                'Maracuj√°',
                'Laranja'
            ]
        };

        // Constante para tipos de sabor
        const FLAVOR_TYPES = {
            'whisky_oldstar': 'Old Star',
            'whisky_jack': 'Jack Daniels',
            'gin_sabores': 'Gin',
            'corote_sabores': 'Corote',
            'vodka_sabores': 'Vodka',
            'ice_askov': 'Askov Ice',
            'ice_leev': 'Ice Leev',
            'beats': 'Beats',
            'h2o_sabores': 'H2O',
            'suco_delvalle': 'Suco Del Valle',
            'suco_kapo': 'Suco Kapo',
            'suco_life': 'Suco Life',
            'energetico_monster': 'Monster',
            'energetico_bally': 'Bally',
            'gelo_sabores': 'Gelo'
        };

        // ============================================
        // ESTADO GLOBAL ATUALIZADO
        // ============================================
        const state = {
            cart: [],
            currentCategory: 'drinks-whisky',
            deliveryType: 'pickup',
            paymentMethod: null,
            paymentConfirmed: false,
            paymentProcessing: false,
            currentOrderId: null,
            currentPreferenceId: null,
            paymentInterval: null,
            pendingProduct: null,
            pendingFlavors: {},
            currentFlavorStep: null,
            currentButton: null,
            adminAuthenticated: false,
            productAvailability: {},
            flavorAvailability: {},
            ageVerified: false
        };

        // ============================================
        // SISTEMA DE FILA DE SINCRONIZA√á√ÉO PERSISTENTE
        // ============================================

        // Inicializar fila de sincroniza√ß√£o
        function initSyncQueue() {
            if (!localStorage.getItem('bebcom_sync_queue')) {
                localStorage.setItem('bebcom_sync_queue', JSON.stringify({
                    pendingProducts: [],
                    pendingFlavors: [],
                    lastAttempt: null,
                    retryCount: 0,
                    maxRetries: 10
                }));
            }
        }

        // Adicionar produtos √† fila de sincroniza√ß√£o
        function addToSyncQueue(type, data) {
            const queue = getSyncQueue();
            
            if (type === 'products') {
                // Evitar duplicados
                const existingIndex = queue.pendingProducts.findIndex(item => 
                    JSON.stringify(item.data) === JSON.stringify(data)
                );
                
                if (existingIndex === -1) {
                    queue.pendingProducts.push({
                        data: data,
                        timestamp: new Date().toISOString(),
                        attempts: 0
                    });
                }
            } else if (type === 'flavors') {
                const existingIndex = queue.pendingFlavors.findIndex(item => 
                    JSON.stringify(item.data) === JSON.stringify(data)
                );
                
                if (existingIndex === -1) {
                    queue.pendingFlavors.push({
                        data: data,
                        timestamp: new Date().toISOString(),
                        attempts: 0
                    });
                }
            }
            
            saveSyncQueue(queue);
        }

        // Obter fila de sincroniza√ß√£o
        function getSyncQueue() {
            const queue = localStorage.getItem('bebcom_sync_queue');
            return queue ? JSON.parse(queue) : {
                pendingProducts: [],
                pendingFlavors: [],
                lastAttempt: null,
                retryCount: 0,
                maxRetries: 10
            };
        }

        // Salvar fila de sincroniza√ß√£o
        function saveSyncQueue(queue) {
            localStorage.setItem('bebcom_sync_queue', JSON.stringify(queue));
        }

        // Limpar item sincronizado da fila
        function removeFromSyncQueue(type, data) {
            const queue = getSyncQueue();
            
            if (type === 'products') {
                queue.pendingProducts = queue.pendingProducts.filter(item => 
                    JSON.stringify(item.data) !== JSON.stringify(data)
                );
            } else if (type === 'flavors') {
                queue.pendingFlavors = queue.pendingFlavors.filter(item => 
                    JSON.stringify(item.data) !== JSON.stringify(data)
                );
            }
            
            queue.lastAttempt = new Date().toISOString();
            saveSyncQueue(queue);
        }

        // Verificar se h√° dados pendentes de sincroniza√ß√£o
        function hasPendingSync() {
            const queue = getSyncQueue();
            return queue.pendingProducts.length > 0 || queue.pendingFlavors.length > 0;
        }

        // ============================================
        // MONITORAMENTO DO BACKEND
        // ============================================

        let backendMonitorInterval = null;
        let backendOfflineSince = null;

        // Fun√ß√£o para verificar status do backend
        async function checkBackendStatus() {
            try {
                const response = await fetch(`${CONFIG.backendUrl}/health`, {
                    method: 'GET',
                    headers: { 'Cache-Control': 'no-cache' }
                });
                
                if (response.ok) {
                    // Backend online
                    if (backendOfflineSince) {
                        const offlineTime = Math.round((Date.now() - backendOfflineSince) / 1000);
                        console.log(`‚úÖ Backend voltou ap√≥s ${offlineTime} segundos offline`);
                        backendOfflineSince = null;
                        
                        // Se estava offline, tentar sincronizar dados pendentes
                        if (hasPendingSync()) {
                            console.log('üîÑ Backend voltou, sincronizando dados pendentes...');
                            setTimeout(() => {
                                syncPendingData();
                            }, 2000);
                        }
                    }
                    return true;
                }
                return false;
            } catch (error) {
                // Backend offline
                if (!backendOfflineSince) {
                    backendOfflineSince = Date.now();
                    console.warn('‚ö†Ô∏è  Backend offline, trabalhando em modo local');
                }
                return false;
            }
        }

        // Iniciar monitoramento do backend
        function startBackendMonitor() {
            if (backendMonitorInterval) clearInterval(backendMonitorInterval);
            
            // Verificar a cada 1 minuto
            backendMonitorInterval = setInterval(() => {
                checkBackendStatus();
            }, 60000); // 1 minuto
            
            // Primeira verifica√ß√£o ap√≥s 10 segundos
            setTimeout(() => {
                checkBackendStatus();
            }, 10000);
            
            console.log('üì° Monitoramento do backend iniciado');
        }

        // ============================================
        // SISTEMA DE RETRY AUTOM√ÅTICO INTELIGENTE
        // ============================================
        let syncRetryInterval = null;

        function startAutoSyncRetry() {
            if (syncRetryInterval) clearInterval(syncRetryInterval);
            
            syncRetryInterval = setInterval(async () => {
                if (hasPendingSync()) {
                    console.log('üîÑ Tentando sincroniza√ß√£o autom√°tica de dados pendentes...');
                    await syncPendingData();
                } else {
                    clearInterval(syncRetryInterval);
                    syncRetryInterval = null;
                }
            }, 30000); // Tentar a cada 30 segundos
        }

        // ============================================
        // INICIALIZA√á√ÉO DO SISTEMA ADMINISTRATIVO
        // ============================================
        function initAdminSystem() {
            console.log('üîß Inicializando sistema administrativo...');
            setupAdminListeners();
        }

        // ============================================
        // INICIALIZA√á√ÉO DA INTERFACE DO USU√ÅRIO
        // ============================================
        async function initUserInterface() {
            console.log('üöÄ Inicializando interface do usu√°rio...');
            
            // S√≥ inicializar o resto do sistema se a idade for verificada
            if (!state.ageVerified) return;
            
            // Inicializar sistema de fila de sincroniza√ß√£o
            initSyncQueue();
            
            // Iniciar monitoramento do backend
            startBackendMonitor();
            
            // Carregar dados persistentes
            loadCartFromLocalStorage();
            
            try {
                // Carregar disponibilidade do servidor (com fallback para localStorage)
                await Promise.all([
                    loadProductAvailability(),
                    loadFlavorAvailability()
                ]);
                
                console.log('‚úÖ Dados carregados');
            } catch (error) {
                console.log('‚ö†Ô∏è Usando dados locais:', error.message);
            }
            
            // Inicializar componentes do usu√°rio
            showCategory('drinks-whisky');
            setupEventListeners();
            
            // Configurar delivery padr√£o
            selectDeliveryType('pickup');
            
            // Configurar m√°scara de telefone
            setupPhoneMask();
            
            // Configurar auto-save
            setupAutoSave();
            
            // Configurar sincroniza√ß√£o autom√°tica
            setupAutoSync();
            
            console.log('‚úÖ Interface do usu√°rio inicializada com sucesso');
        }

        // ============================================
        // FUN√á√ïES PARA DISPONIBILIDADE DE PRODUTOS (COM BACKEND)
        // ============================================

        // Carregar disponibilidade de produtos do backend
        async function loadProductAvailability() {
            try {
                // PRIMEIRO: Verificar se h√° dados pendentes de sincroniza√ß√£o
                const queue = getSyncQueue();
                if (queue.pendingProducts.length > 0) {
                    console.log('üì§ H√° dados de produtos pendentes de sincroniza√ß√£o');
                    
                    // Tentar sincronizar automaticamente
                    setTimeout(async () => {
                        await syncPendingData();
                    }, 2000);
                }
                
                // SEGUNDO: Tentar carregar do servidor
                const response = await fetch(`${CONFIG.backendUrl}/api/product-availability`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.productAvailability) {
                        state.productAvailability = data.productAvailability;
                        localStorage.setItem('bebcom_product_availability', JSON.stringify(state.productAvailability));
                        console.log('‚úÖ Disponibilidade de produtos carregada do servidor');
                        return true;
                    }
                }
                throw new Error('Resposta inv√°lida do servidor');
            } catch (error) {
                console.log('‚ö†Ô∏è Fallback: Carregando produtos do localStorage');
                
                // Fallback para localStorage
                const saved = localStorage.getItem('bebcom_product_availability');
                state.productAvailability = saved ? JSON.parse(saved) : {};
                
                // Inicializar produtos faltantes como dispon√≠veis
                Object.keys(products).forEach(category => {
                    products[category].forEach(product => {
                        if (state.productAvailability[product.id] === undefined) {
                            state.productAvailability[product.id] = true;
                        }
                    });
                });
                
                return false;
            }
        }

        // Carregar disponibilidade de sabores do backend
        async function loadFlavorAvailability() {
            try {
                const response = await fetch(`${CONFIG.backendUrl}/api/flavor-availability`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.flavorAvailability) {
                        state.flavorAvailability = data.flavorAvailability;
                        localStorage.setItem('bebcom_flavor_availability', JSON.stringify(state.flavorAvailability));
                        console.log('‚úÖ Disponibilidade de sabores carregada do servidor');
                        return true;
                    }
                }
                throw new Error('Resposta inv√°lida do servidor');
            } catch (error) {
                console.log('‚ö†Ô∏è Fallback: Carregando sabores do localStorage');
                // Fallback para localStorage
                const saved = localStorage.getItem('bebcom_flavor_availability');
                state.flavorAvailability = saved ? JSON.parse(saved) : {};
                return false;
            }
        }

        // Verificar se produto est√° dispon√≠vel
        function isProductAvailable(productId) {
            return state.productAvailability[productId] !== false;
        }

        // Verificar se sabor est√° dispon√≠vel
        function isFlavorAvailable(flavorType, flavorName) {
            const key = `${flavorType}_${flavorName}`;
            return state.flavorAvailability[key] !== false;
        }

        // ============================================
        // FUN√á√ïES DO CARD√ÅPIO
        // ============================================
        function showCategory(categoryId) {
            state.currentCategory = categoryId;
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';

            const categoryProducts = products[categoryId] || [];

            if (categoryProducts.length === 0) {
                productsGrid.innerHTML = '<div style="text-align: center; color: #aaa; padding: 40px;">Nenhum produto nesta categoria</div>';
                return;
            }

            categoryProducts.forEach((product) => {
                const isAvailable = isProductAvailable(product.id);
                const hasFlavors = product.requiresFlavorSelection || false;

                const productCard = document.createElement('div');
                productCard.className = `product-card ${!isAvailable ? 'unavailable' : ''} ${hasFlavors ? 'with-flavors' : ''}`;
                productCard.setAttribute('data-product-id', product.id);

                let buttonText = 'üõí Adicionar';
                let buttonClass = 'add-to-cart-btn';

                if (!isAvailable) {
                    buttonText = '‚ùå Indispon√≠vel';
                } else if (hasFlavors) {
                    buttonText = '‚ö° Escolher Sabores';
                    buttonClass += ' has-flavors';
                }

                productCard.innerHTML = `
                    ${hasFlavors ? '<div class="flavor-badge">‚ö°</div>' : ''}
                    <div class="product-name">${product.name}</div>
                    <div class="product-info">${product.description}</div>
                    <div class="product-price">R$ ${product.price.toFixed(2)}</div>
                    <button class="${buttonClass}"
                            onclick="handleAddToCart('${product.id}', this)"
                            ${!isAvailable ? 'disabled' : ''}>
                        ${buttonText}
                    </button>
                `;
                productsGrid.appendChild(productCard);
            });
        }

        // ============================================
        // SISTEMA DE SELE√á√ÉO DE SABORES
        // ============================================
        function handleAddToCart(productId, button) {
            const product = findProductById(productId);
            if (!product) {
                showNotification('‚ùå Produto n√£o encontrado', 'error');
                return;
            }

            if (!isProductAvailable(productId)) {
                showNotification('‚ùå Este produto est√° temporariamente indispon√≠vel', 'error');
                return;
            }

            if (product.requiresFlavorSelection) {
                state.pendingProduct = product;
                state.pendingFlavors = {};
                state.currentFlavorStep = 'primary';
                state.currentButton = button;

                if (product.flavorType && FLAVOR_CATALOG[product.flavorType]) {
                    // Verificar se h√° algum sabor dispon√≠vel
                    const flavors = FLAVOR_CATALOG[product.flavorType];
                    const hasAvailableFlavor = flavors.some(flavor =>
                        isFlavorAvailable(product.flavorType, flavor)
                    );

                    if (!hasAvailableFlavor) {
                        showNotification('‚ùå Todos os sabores deste produto est√£o indispon√≠veis', 'error');
                        return;
                    }

                    openFlavorModal(product, 'primary');
                } else {
                    addToCartDirect(product, button);
                }
            } else {
                addToCartDirect(product, button);
            }
        }

        function findProductById(productId) {
            for (const category in products) {
                const found = products[category].find(p => p.id === productId);
                if (found) return found;
            }
            return null;
        }

        function openFlavorModal(product, step) {
            const modal = document.getElementById('flavorModal');
            const title = document.getElementById('flavorModalTitle');
            const instruction = document.getElementById('flavorModalInstruction');
            const grid = document.getElementById('flavorsGrid');
            const confirmButton = document.getElementById('confirmFlavorButton');

            grid.innerHTML = '<div style="text-align: center; padding: 20px; color: #aaa;">Carregando sabores...</div>';
            state.currentFlavorStep = step;

            setTimeout(() => {
                grid.innerHTML = '';

                let flavorType = product.flavorType;
                let flavors = FLAVOR_CATALOG[flavorType] || [];

                if (step === 'ice' && product.nextStep === 'ice') {
                    flavorType = 'gelo_sabores';
                    flavors = FLAVOR_CATALOG.gelo_sabores || [];
                    title.textContent = 'üßä Escolha o sabor do gelo';
                    instruction.textContent = 'Selecione um sabor para o seu drink (sem custo adicional)';
                } else {
                    title.textContent = `Escolha o sabor do ${getFlavorTypeName(flavorType)}`;
                    instruction.textContent = `Selecione o sabor desejado para ${product.name}`;
                }

                if (flavors.length === 0) {
                    grid.innerHTML = '<div style="text-align: center; padding: 20px; color: #dc2626;">Nenhum sabor dispon√≠vel</div>';
                    confirmButton.disabled = true;
                    return;
                }

                let hasAvailableFlavor = false;

                flavors.forEach(flavor => {
                    const isAvailable = isFlavorAvailable(flavorType, flavor);
                    const option = document.createElement('div');
                    option.className = `flavor-option ${!isAvailable ? 'unavailable' : ''}`;
                    option.textContent = flavor;
                    option.dataset.flavor = flavor;

                    if (!isAvailable) {
                        option.style.opacity = '0.6';
                        option.style.cursor = 'not-allowed';
                    } else {
                        hasAvailableFlavor = true;
                        option.onclick = function() {
                            document.querySelectorAll('.flavor-option').forEach(el => {
                                el.classList.remove('selected');
                            });
                            this.classList.add('selected');

                            if (step === 'primary') {
                                state.pendingFlavors.primary = flavor;
                            } else if (step === 'ice') {
                                state.pendingFlavors.ice = flavor;
                            }

                            confirmButton.disabled = false;
                        };
                    }

                    grid.appendChild(option);
                });

                if (!hasAvailableFlavor) {
                    instruction.textContent = '‚ö†Ô∏è Todos os sabores est√£o temporariamente indispon√≠veis';
                    instruction.style.color = '#dc2626';
                }

                confirmButton.disabled = true;
                modal.style.display = 'flex';
            }, 100);
        }

        function getFlavorTypeName(flavorType) {
            return FLAVOR_TYPES[flavorType] || 'produto';
        }

        function confirmFlavorSelection() {
            const modal = document.getElementById('flavorModal');

            if (state.currentFlavorStep === 'primary' && !state.pendingFlavors.primary) {
                alert('Por favor, selecione um sabor');
                return;
            }

            if (state.currentFlavorStep === 'ice' && !state.pendingFlavors.ice) {
                alert('Por favor, selecione um sabor de gelo');
                return;
            }

            modal.style.display = 'none';

            if (state.currentFlavorStep === 'primary' && state.pendingProduct.nextStep === 'ice') {
                openFlavorModal(state.pendingProduct, 'ice');
            } else {
                addToCartWithFlavors();
            }
        }

        function cancelFlavorSelection() {
            document.getElementById('flavorModal').style.display = 'none';
            state.pendingProduct = null;
            state.pendingFlavors = {};
            state.currentFlavorStep = null;
            state.currentButton = null;
        }

        function addToCartWithFlavors() {
            if (!state.pendingProduct) return;

            const product = state.pendingProduct;
            const flavors = state.pendingFlavors;

            const existingItem = findCartItemWithSameFlavors(product.name, flavors);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                state.cart.push({
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    productId: product.id,
                    flavors: { ...flavors }
                });
            }

            updateCartDisplay();
            saveCartToLocalStorage();

            if (state.currentButton) {
                const originalText = state.currentButton.innerHTML;
                state.currentButton.innerHTML = '‚úì Adicionado!';
                state.currentButton.classList.add('added');

                setTimeout(() => {
                    state.currentButton.innerHTML = originalText;
                    state.currentButton.classList.remove('added');
                }, 1000);
            }

            state.pendingProduct = null;
            state.pendingFlavors = {};
            state.currentFlavorStep = null;
            state.currentButton = null;

            showNotification(`‚úÖ ${product.name} adicionado ao carrinho!`);
        }

        function findCartItemWithSameFlavors(productName, flavors) {
            return state.cart.find(item => {
                if (item.name !== productName) return false;
                if (!item.flavors && !flavors) return true;
                if (!item.flavors || !flavors) return false;

                const itemFlavors = JSON.stringify(item.flavors);
                const newFlavors = JSON.stringify(flavors);
                return itemFlavors === newFlavors;
            });
        }

        function addToCartDirect(product, button) {
            const existingItem = state.cart.find(item =>
                item.name === product.name && !item.flavors && item.productId === product.id
            );

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                state.cart.push({
                    name: product.name,
                    price: product.price,
                    quantity: 1,
                    productId: product.id
                });
            }

            updateCartDisplay();
            saveCartToLocalStorage();

            if (button) {
                const originalText = button.innerHTML;
                button.innerHTML = '‚úì Adicionado!';
                button.classList.add('added');

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('added');
                }, 1000);
            }

            showNotification(`‚úÖ ${product.name} adicionado ao carrinho!`);
        }

        // ============================================
        // FUN√á√ïES DO CARRINHO
        // ============================================
        function updateCartDisplay() {
            const cartItems = document.getElementById('cartItems');
            const subtotalElement = document.getElementById('subtotal');
            const totalAmountElement = document.getElementById('totalAmount');
            const deliveryRow = document.getElementById('deliveryRow');
            const deliveryFeeElement = document.getElementById('deliveryFee');

            let subtotal = 0;

            if (state.cart.length === 0) {
                cartItems.innerHTML = '<div style="text-align: center; color: #aaa; padding: 40px;">Seu carrinho est√° vazio<br><small>Adicione produtos do card√°pio</small></div>';
                subtotalElement.textContent = '0.00';
                totalAmountElement.textContent = '0.00';
                updatePayButtonText();
                validateForm();
                return;
            }

            cartItems.innerHTML = '';

            state.cart.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;

                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';

                let itemName = item.name;
                if (item.flavors) {
                    if (item.flavors.primary) {
                        itemName += ` (Sabor: ${item.flavors.primary})`;
                    }
                    if (item.flavors.ice) {
                        itemName += ` (Gelo: ${item.flavors.ice})`;
                    }
                }

                cartItem.innerHTML = `
                    <div>
                        <strong>${itemName}</strong><br>
                        <small>R$${item.price.toFixed(2)} un.</small>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <button onclick="updateQuantity(${index}, -1)" class="quantity-btn">-</button>
                        <span style="min-width: 20px; text-align: center;">${item.quantity}</span>
                        <button onclick="updateQuantity(${index}, 1)" class="quantity-btn">+</button>
                        <span style="margin-left: 10px; font-weight: bold;">R$${itemTotal.toFixed(2)}</span>
                        <button onclick="removeFromCart(${index})" class="remove-item-btn">‚úï</button>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });

            let deliveryFee = 0;
            if (state.deliveryType === 'delivery') {
                deliveryFee = CONFIG.deliveryRates.baseFee;
                if (subtotal >= CONFIG.deliveryRates.freeDeliveryMin) {
                    deliveryFee = 0;
                }
                deliveryRow.style.display = 'flex';
                deliveryFeeElement.textContent = deliveryFee.toFixed(2);
            } else {
                deliveryRow.style.display = 'none';
            }

            const total = subtotal + deliveryFee;

            subtotalElement.textContent = subtotal.toFixed(2);
            totalAmountElement.textContent = total.toFixed(2);

            validateForm();
        }

        function updateQuantity(index, change) {
            if (state.cart[index]) {
                const newQuantity = state.cart[index].quantity + change;

                if (newQuantity < 1) {
                    removeFromCart(index);
                } else if (newQuantity > 50) {
                    showNotification('‚ùå Quantidade m√°xima √© 50 unidades', 'error');
                } else {
                    state.cart[index].quantity = newQuantity;
                    updateCartDisplay();
                    saveCartToLocalStorage();
                }
            }
        }

        function removeFromCart(index) {
            if (state.cart[index]) {
                const itemName = state.cart[index].name;
                if (confirm(`Remover "${itemName}" do carrinho?`)) {
                    state.cart.splice(index, 1);
                    updateCartDisplay();
                    saveCartToLocalStorage();
                    showNotification('üóëÔ∏è Item removido do carrinho');
                }
            }
        }

        function clearCart() {
            if (state.cart.length === 0) return;

            if (confirm('Tem certeza que deseja limpar o carrinho?')) {
                state.cart = [];
                updateCartDisplay();
                saveCartToLocalStorage();
                showNotification('üóëÔ∏è Carrinho limpo', 'info');
            }
        }

        // ============================================
        // SISTEMA DE PERSIST√äNCIA
        // ============================================
        function saveCartToLocalStorage() {
            try {
                const cartData = {
                    items: state.cart,
                    timestamp: Date.now(),
                    version: '3.0'
                };
                localStorage.setItem('bebcom_cart', JSON.stringify(cartData));
                return true;
            } catch (e) {
                console.error('‚ùå Erro ao salvar carrinho:', e);
                return false;
            }
        }

        function loadCartFromLocalStorage() {
            try {
                const saved = localStorage.getItem('bebcom_cart');
                if (saved) {
                    const cartData = JSON.parse(saved);

                    if (Array.isArray(cartData)) {
                        state.cart = cartData;
                    } else if (cartData.items && Array.isArray(cartData.items)) {
                        state.cart = cartData.items;
                    }

                    updateCartDisplay();
                }
            } catch (e) {
                console.error('‚ùå Erro ao carregar carrinho:', e);
                state.cart = [];
            }
        }

        // ============================================
        // FUN√á√ïES DE ENTREGA
        // ============================================
        function selectDeliveryType(type) {
            state.deliveryType = type;
            const paymentLabel = document.getElementById('paymentLabel');
            const paymentMethods = document.getElementById('paymentMethods');
            const payButton = document.getElementById('payButton');

            const pickupBtn = document.querySelector('.delivery-option:nth-child(1)');
            const deliveryBtn = document.querySelector('.delivery-option:nth-child(2)');
            const addressFields = document.getElementById('addressFields');

            if (type === 'pickup') {
                pickupBtn.classList.add('selected');
                deliveryBtn.classList.remove('selected');
                addressFields.style.display = 'none';

                paymentLabel.style.display = 'none';
                paymentMethods.style.display = 'none';

                payButton.disabled = true;
                payButton.textContent = 'üè™ Retirada no Local';

                state.paymentMethod = null;
                state.paymentConfirmed = false;

            } else {
                pickupBtn.classList.remove('selected');
                deliveryBtn.classList.add('selected');
                addressFields.style.display = 'block';

                paymentLabel.style.display = 'block';
                paymentMethods.style.display = 'grid';

                payButton.disabled = false;
                selectPaymentMethod('pix');
            }

            updateCartDisplay();
            validateForm();
        }

        // ============================================
        // FUN√á√ïES DE PAGAMENTO (COM BACKEND SEGURO)
        // ============================================
        function selectPaymentMethod(method) {
            if (state.deliveryType !== 'delivery') return;

            state.paymentMethod = method;

            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });

            const selectedMethod = document.querySelector(`.payment-method:nth-child(${method === 'pix' ? 1 : 2})`);
            if (selectedMethod) {
                selectedMethod.classList.add('selected');
            }

            updatePayButtonText();
            validateForm();
        }

        function updatePayButtonText() {
            const button = document.getElementById('payButton');
            if (state.deliveryType === 'delivery') {
                const texts = {
                    pix: 'üßæ Pagar com PIX',
                    card_online: 'üí≥ Pagar com Cart√£o'
                };
                button.innerHTML = texts[state.paymentMethod] || 'üí∞ Realizar Pagamento';
            } else {
                button.innerHTML = 'üè™ Retirada no Local';
            }
        }

        function validateOrder() {
            const errors = [];
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();

            if (!customerName) errors.push('‚Ä¢ Digite seu nome completo');
            if (!customerPhone || customerPhone.length < 10) errors.push('‚Ä¢ Digite um WhatsApp v√°lido');
            if (state.cart.length === 0) errors.push('‚Ä¢ Adicione itens ao carrinho');

            if (state.deliveryType === 'delivery') {
                const street = document.getElementById('street').value.trim();
                const number = document.getElementById('number').value.trim();
                const neighborhood = document.getElementById('neighborhood').value.trim();
                const city = document.getElementById('city').value.trim();

                if (!street) errors.push('‚Ä¢ Digite a rua');
                if (!number) errors.push('‚Ä¢ Digite o n√∫mero');
                if (!neighborhood) errors.push('‚Ä¢ Digite o bairro');
                if (!city) errors.push('‚Ä¢ Digite a cidade');

                if (!state.paymentMethod) errors.push('‚Ä¢ Selecione um m√©todo de pagamento');
            }

            return errors;
        }

        async function processPayment() {
            if (state.deliveryType === 'pickup') {
                alert('Para retirada, o pagamento ser√° realizado no local.');
                return;
            }

            if (state.paymentProcessing) return;

            const errors = validateOrder();
            if (errors.length > 0) {
                alert(errors.join('\n'));
                return;
            }

            state.paymentProcessing = true;
            const button = document.getElementById('payButton');
            const originalText = button.innerHTML;
            const statusDiv = document.getElementById('paymentStatus');

            button.innerHTML = '<span class="loading-spinner"></span> Processando...';
            button.disabled = true;

            statusDiv.style.display = 'block';
            statusDiv.className = 'payment-status';
            statusDiv.innerHTML = 'üîÑ Processando seu pedido...';

            try {
                await processOnlinePayment();
            } catch (error) {
                console.error('Erro no processamento:', error);
                statusDiv.className = 'payment-status error';
                statusDiv.innerHTML = `‚ùå ${error.message || 'Erro ao processar pedido'}`;
                resetPayButton(originalText);
                state.paymentProcessing = false;
            }
        }

        async function processOnlinePayment() {
            try {
                const orderData = prepareOrderData();
                state.currentOrderId = 'BEB' + Date.now().toString().slice(-8);

                const customerName = document.getElementById('customerName').value.trim();
                const customerPhone = document.getElementById('customerPhone').value.trim();

                const response = await fetch(`${CONFIG.backendUrl}/api/create-payment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        orderId: state.currentOrderId,
                        customer: {
                            name: customerName,
                            phone: customerPhone,
                            email: 'cliente@bebcom.com'
                        },
                        items: orderData.items,
                        deliveryType: state.deliveryType,
                        paymentMethod: state.paymentMethod,
                        totalAmount: orderData.total,
                        deliveryFee: orderData.deliveryFee
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Erro ao criar pagamento');
                }

                const data = await response.json();

                if (data.success) {
                    if (data.paymentUrl) {
                        // Redirecionar para URL de pagamento
                        window.open(data.paymentUrl, '_blank');
                        startPaymentStatusCheck(state.currentOrderId);
                    } else if (data.qrCode) {
                        // Mostrar QR Code PIX
                        showPixPayment(data.qrCode, data.copyPasteKey);
                    } else {
                        // Pagamento direto
                        confirmPayment();
                    }
                } else {
                    throw new Error(data.error || 'Erro no processamento');
                }

            } catch (error) {
                console.error('Erro:', error);
                // Fallback para PIX manual
                showManualPixPayment();
            }
        }

        function showPixPayment(qrCode, copyPasteKey) {
            const statusDiv = document.getElementById('paymentStatus');
            const orderData = prepareOrderData();
            const total = orderData.total;

            statusDiv.className = 'payment-status';
            statusDiv.innerHTML = `
                <div style="text-align: center;">
                    <h4 style="margin-bottom: 15px;">üßæ PIX para Pagamento</h4>
                    <p>Valor: <strong>R$ ${total.toFixed(2)}</strong></p>
                    <div style="margin: 15px 0;">
                        <img src="${qrCode}" alt="QR Code PIX" style="width: 200px; height: 200px; border: 2px solid #28a745; border-radius: 8px;">
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: left;">
                        <strong>Chave PIX para copiar:</strong><br>
                        <span style="font-family: monospace; word-break: break-all; color: #333;">
                            ${copyPasteKey}
                        </span>
                        <button onclick="navigator.clipboard.writeText('${copyPasteKey}'); alert('Chave PIX copiada!');"
                                style="margin-top: 10px; background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                            üìã Copiar Chave
                        </button>
                    </div>
                    <p style="font-size: 14px; color: #aaa;">
                        ‚è±Ô∏è Ap√≥s pagar, clique em "J√° Paguei" para confirmar
                    </p>
                    <button onclick="confirmPayment()" style="
                        background: #28a745; color: white; border: none;
                        padding: 12px 24px; border-radius: 8px; cursor: pointer;
                        margin: 10px; font-weight: bold;">
                        ‚úÖ J√° Paguei
                    </button>
                    <button onclick="cancelPayment()" style="
                        background: #dc3545; color: white; border: none;
                        padding: 12px 24px; border-radius: 8px; cursor: pointer;
                        margin: 10px; font-weight: bold;">
                        ‚ùå Cancelar
                    </button>
                </div>
            `;

            state.paymentProcessing = false;
            document.getElementById('payButton').style.display = 'none';
        }

        function showManualPixPayment() {
            const statusDiv = document.getElementById('paymentStatus');
            const orderData = prepareOrderData();
            const total = orderData.total;

            statusDiv.className = 'payment-status';
            statusDiv.innerHTML = `
                <div style="text-align: center;">
                    <h4 style="margin-bottom: 15px;">üßæ PIX Manual</h4>
                    <p>Valor: <strong>R$ ${total.toFixed(2)}</strong></p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>Chave PIX (CNPJ):</strong><br>
                        <span style="font-family: monospace; word-break: break-all;">
                            12.345.678/0001-90
                        </span>
                    </div>
                    <p style="font-size: 14px; color: #aaa;">
                        ‚è±Ô∏è Ap√≥s pagar, envie o comprovante para o WhatsApp (14) 99613-0369
                    </p>
                    <button onclick="confirmPayment()" style="
                        background: #28a745; color: white; border: none;
                        padding: 12px 24px; border-radius: 8px; cursor: pointer;
                        margin: 10px; font-weight: bold;">
                        ‚úÖ J√° Paguei
                    </button>
                    <button onclick="cancelPayment()" style="
                        background: #dc3545; color: white; border: none;
                        padding: 12px 24px; border-radius: 8px; cursor: pointer;
                        margin: 10px; font-weight: bold;">
                        ‚ùå Cancelar
                    </button>
                </div>
            `;

            state.paymentProcessing = false;
            document.getElementById('payButton').style.display = 'none';
        }

        function cancelPayment() {
            resetPaymentState();
            document.getElementById('paymentStatus').style.display = 'none';
            document.getElementById('payButton').style.display = 'block';
        }

        function prepareOrderData() {
            const items = state.cart.map(item => ({
                name: item.name,
                quantity: item.quantity,
                price: item.price,
                flavors: item.flavors || null,
                productId: item.productId
            }));

            const itemsTotal = items.reduce((sum, i) => sum + (i.quantity * i.price), 0);

            let deliveryFee = 0;
            if (state.deliveryType === 'delivery') {
                deliveryFee = CONFIG.deliveryRates.baseFee;
                if (itemsTotal >= CONFIG.deliveryRates.freeDeliveryMin) {
                    deliveryFee = 0;
                }
            }

            return {
                items,
                deliveryFee,
                total: itemsTotal + deliveryFee,
                orderType: state.deliveryType,
                paymentMethod: state.paymentMethod
            };
        }

        function startPaymentStatusCheck(orderId) {
            if (state.paymentInterval) clearInterval(state.paymentInterval);

            state.paymentInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${CONFIG.backendUrl}/api/order-status/${orderId}`);
                    if (!response.ok) return;

                    const data = await response.json();

                    if (data.paid) {
                        clearInterval(state.paymentInterval);
                        confirmPayment();
                    }
                } catch (error) {
                    console.error('Erro ao verificar status:', error);
                }
            }, 5000);

            setTimeout(() => {
                if (state.paymentInterval) {
                    clearInterval(state.paymentInterval);
                    showPaymentError('Tempo limite excedido. Tente novamente.');
                }
            }, 30 * 60 * 1000);
        }

        function confirmPayment() {
            if (state.deliveryType === 'delivery') {
                state.paymentConfirmed = true;
            }

            state.paymentProcessing = false;

            if (state.paymentInterval) {
                clearInterval(state.paymentInterval);
                state.paymentInterval = null;
            }

            const statusDiv = document.getElementById('paymentStatus');
            statusDiv.className = 'payment-status success';
            statusDiv.innerHTML = state.deliveryType === 'delivery'
                ? '‚úÖ Pagamento confirmado com sucesso!'
                : '‚úÖ Pedido confirmado para retirada!';

            const payButton = document.getElementById('payButton');
            payButton.innerHTML = state.deliveryType === 'delivery'
                ? '‚úÖ Pagamento Confirmado'
                : '‚úÖ Retirada Confirmada';
            payButton.disabled = true;

            const whatsappButton = document.getElementById('whatsappButton');
            whatsappButton.disabled = false;

            showNotification(state.deliveryType === 'delivery'
                ? 'Pagamento confirmado! Agora envie o pedido pelo WhatsApp.'
                : 'Pedido confirmado! Agora envie o pedido pelo WhatsApp.');
        }

        function showPaymentError(message) {
            const statusDiv = document.getElementById('paymentStatus');
            statusDiv.className = 'payment-status error';
            statusDiv.innerHTML = `‚ùå ${message}`;
            state.paymentProcessing = false;
            resetPayButton();
        }

        function resetPayButton(originalText) {
            const button = document.getElementById('payButton');
            if (state.deliveryType === 'delivery') {
                button.innerHTML = originalText || 'üí∞ Realizar Pagamento';
                button.disabled = false;
            } else {
                button.innerHTML = 'üè™ Retirada no Local';
                button.disabled = true;
            }
            state.paymentProcessing = false;
        }

        function resetPaymentState() {
            state.paymentConfirmed = false;
            state.paymentProcessing = false;
            state.currentOrderId = null;
            state.currentPreferenceId = null;

            if (state.paymentInterval) {
                clearInterval(state.paymentInterval);
                state.paymentInterval = null;
            }

            document.getElementById('paymentStatus').style.display = 'none';
            document.getElementById('whatsappButton').disabled = true;

            if (state.deliveryType === 'delivery') {
                selectPaymentMethod('pix');
            } else {
                state.paymentMethod = null;
            }
        }

        // ============================================
        // FUN√á√ïES DO WHATSAPP
        // ============================================
        function validateForm() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const whatsappButton = document.getElementById('whatsappButton');

            let isValid = true;

            // Valida√ß√£o de nome
            if (customerName.length < 3) {
                isValid = false;
            }

            // Valida√ß√£o de telefone
            const phoneRegex = /^\(\d{2}\) \d{5}-\d{4}$/;
            if (!phoneRegex.test(customerPhone) && customerPhone.replace(/\D/g, '').length < 10) {
                isValid = false;
            }

            // Valida√ß√£o do carrinho
            if (state.cart.length === 0) {
                isValid = false;
            }

            // Valida√ß√£o de endere√ßo para entrega
            if (state.deliveryType === 'delivery') {
                const street = document.getElementById('street').value.trim();
                const number = document.getElementById('number').value.trim();
                const neighborhood = document.getElementById('neighborhood').value.trim();
                const city = document.getElementById('city').value.trim();

                if (!street || street.length < 3) isValid = false;
                if (!number || !/^\d+$/.test(number)) isValid = false;
                if (!neighborhood || neighborhood.length < 3) isValid = false;
                if (!city || city.length < 3) isValid = false;

                if (!state.paymentMethod) isValid = false;
                if (!state.paymentConfirmed) isValid = false;
            }

            whatsappButton.disabled = !isValid;

            // Atualizar estilo do bot√£o
            if (isValid) {
                whatsappButton.style.opacity = '1';
                whatsappButton.style.cursor = 'pointer';
            } else {
                whatsappButton.style.opacity = '0.7';
                whatsappButton.style.cursor = 'not-allowed';
            }

            return isValid;
        }

        function sendToWhatsApp() {
            if (!validateForm()) {
                alert('Complete todas as informa√ß√µes antes de enviar!');
                return;
            }

            try {
                const message = prepareWhatsAppMessage();
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/${CONFIG.whatsappNumber}?text=${encodedMessage}`;

                window.open(whatsappUrl, '_blank');

                alert('‚úÖ Pedido enviado! Aguarde nosso contato no WhatsApp.');

                resetPaymentState();

            } catch (error) {
                console.error('Erro ao enviar:', error);
                alert('‚ùå Erro ao preparar pedido. Tente novamente.');
            }
        }

        function prepareWhatsAppMessage() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const street = document.getElementById('street').value.trim();
            const number = document.getElementById('number').value.trim();
            const neighborhood = document.getElementById('neighborhood').value.trim();
            const city = document.getElementById('city').value.trim();
            const complement = document.getElementById('addressComplement').value.trim();

            const orderData = prepareOrderData();
            const orderId = state.currentOrderId || 'BEB' + Date.now().toString().slice(-8);

            let message = `*üçπ PEDIDO BEBCOM DELIVERY üöö*\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `üìã *N¬∫ do Pedido:* ${orderId}\n`;
            message += `üë§ *Cliente:* ${customerName}\n`;
            message += `üìû *WhatsApp:* ${customerPhone}\n`;
            message += `üì¶ *Tipo:* ${state.deliveryType === 'delivery' ? 'ENTREGA' : 'RETIRADA'}\n`;

            if (state.deliveryType === 'delivery') {
                const fullAddress = `${street}, ${number} - ${neighborhood}, ${city}`;
                message += `üìç *Endere√ßo:* ${fullAddress}\n`;
                if (complement) {
                    message += `üè† *Complemento:* ${complement}\n`;
                }

                message += `üí≥ *Pagamento:* ${getPaymentMethodText()}\n`;
            }

            message += `üìÖ *Data/Hora:* ${new Date().toLocaleString('pt-BR')}\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `\nüõí *ITENS DO PEDIDO:*\n`;

            orderData.items.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                message += `\n${index + 1}. ${item.name}\n`;

                if (item.flavors) {
                    if (item.flavors.primary) {
                        message += `   üçπ *Sabor:* ${item.flavors.primary}\n`;
                    }
                    if (item.flavors.ice) {
                        message += `   üßä *Sabor do gelo:* ${item.flavors.ice}\n`;
                    }
                }

                message += `   ${item.quantity} √ó R$ ${item.price.toFixed(2)} = R$ ${itemTotal.toFixed(2)}`;
            });

            message += `\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `üí∞ *Subtotal:* R$ ${(orderData.total - orderData.deliveryFee).toFixed(2)}\n`;

            if (state.deliveryType === 'delivery') {
                message += `üöö *Taxa de Entrega:* R$ ${orderData.deliveryFee.toFixed(2)}\n`;
                if (orderData.deliveryFee === 0 && (orderData.total - orderData.deliveryFee) >= CONFIG.deliveryRates.freeDeliveryMin) {
                    message += `üéâ *Frete Gr√°tis!*\n`;
                }
            }

            message += `üí≥ *Total Geral:* R$ ${orderData.total.toFixed(2)}\n`;
            message += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `‚úÖ *Pedido confirmado!*\n`;

            if (state.deliveryType === 'delivery') {
                message += `‚è±Ô∏è *Tempo estimado:* 40-60 minutos\n`;
            }

            message += `üìû *D√∫vidas:* (14) 99613-0369\n`;
            message += `\nüéâ *Obrigado pela prefer√™ncia!*\n`;
            message += `_BebCom Delivery - Seu momento, nossa companhia_`;

            return message;
        }

        function getPaymentMethodText() {
            if (state.deliveryType === 'delivery') {
                switch(state.paymentMethod) {
                    case 'pix': return 'PIX Online' + (state.paymentConfirmed ? ' ‚úÖ PAGO' : '');
                    case 'card_online': return 'Cart√£o Online' + (state.paymentConfirmed ? ' ‚úÖ PAGO' : '');
                    default: return '';
                }
            } else {
                return '';
            }
        }

        // ============================================
        // SISTEMA ADMINISTRATIVO
        // ============================================
        function setupAdminListeners() {
            console.log('üîß Configurando listeners administrativos...');
            
            const adminButton = document.getElementById('adminButton');
            const adminClose = document.getElementById('adminClose');
            const adminModal = document.getElementById('adminModal');
            
            if (adminButton) {
                adminButton.addEventListener('click', openAdminPanel);
                console.log('‚úÖ Bot√£o admin configurado');
            } else {
                console.error('‚ùå Bot√£o admin n√£o encontrado!');
            }
            
            if (adminClose) {
                adminClose.addEventListener('click', closeAdminPanel);
                console.log('‚úÖ Bot√£o fechar admin configurado');
            }
            
            if (adminModal) {
                adminModal.addEventListener('click', function(e) {
                    if (e.target === this) closeAdminPanel();
                });
                console.log('‚úÖ Modal admin configurado');
            }

            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.altKey && e.key === 'a') {
                    e.preventDefault();
                    openAdminPanel();
                }

                if (e.key === 'Escape') {
                    closeAdminPanel();
                }
            });
            
            console.log('‚úÖ Sistema administrativo configurado com sucesso');
        }

        function openAdminPanel() {
            console.log('üîß Abrindo painel administrativo...');
            document.getElementById('adminModal').style.display = 'block';

            if (!state.adminAuthenticated) {
                document.getElementById('passwordSection').style.display = 'block';
                document.getElementById('adminMain').style.display = 'none';
                document.getElementById('adminActions').style.display = 'none';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            } else {
                document.getElementById('passwordSection').style.display = 'none';
                document.getElementById('adminMain').style.display = 'block';
                document.getElementById('adminActions').style.display = 'block';
                loadAdminProducts();
            }
        }

        function closeAdminPanel() {
            document.getElementById('adminModal').style.display = 'none';
            state.adminAuthenticated = false;
        }

        async function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            const button = document.querySelector('.password-button');
            const originalText = button.innerHTML;

            // Mostrar loading
            button.innerHTML = '<span class="loading-spinner"></span> Verificando...';
            button.disabled = true;

            try {
                // 1. Primeiro tenta verificar com senha direta
                if (password === CONFIG.adminPassword) {
                    state.adminAuthenticated = true;
                    document.getElementById('passwordSection').style.display = 'none';
                    document.getElementById('adminMain').style.display = 'block';
                    document.getElementById('adminActions').style.display = 'block';
                    loadAdminProducts();
                    showNotification('‚úÖ Acesso administrativo concedido');
                    return;
                }

                // 2. Se n√£o for a senha direta, tenta verificar com hash
                const hashResponse = await fetch(`${CONFIG.backendUrl}/api/admin-password`);
                
                if (!hashResponse.ok) {
                    throw new Error('N√£o foi poss√≠vel verificar a senha no servidor');
                }

                const hashData = await hashResponse.json();
                
                if (!hashData.success) {
                    throw new Error('Erro na resposta do servidor');
                }

                // Fun√ß√£o para calcular hash SHA-256
                async function calculateHash(text) {
                    const encoder = new TextEncoder();
                    const data = encoder.encode(text);
                    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                    const hashArray = Array.from(new Uint8Array(hashBuffer));
                    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                    return hashHex;
                }

                // Calcula os hashes
                const passwordHash = await calculateHash(password);
                const passwordHashWithSalt = await calculateHash(password + hashData.salt);
                
                // Verifica se algum dos hashes corresponde
                if (passwordHash === hashData.passwordHash || 
                    passwordHashWithSalt === hashData.passwordHash) {
                    
                    state.adminAuthenticated = true;
                    document.getElementById('passwordSection').style.display = 'none';
                    document.getElementById('adminMain').style.display = 'block';
                    document.getElementById('adminActions').style.display = 'block';
                    loadAdminProducts();
                    showNotification('‚úÖ Acesso administrativo concedido');
                    
                } else {
                    throw new Error('Senha incorreta');
                }

            } catch (error) {
                console.error('Erro na verifica√ß√£o:', error);
                alert(`‚ùå ${error.message || 'Senha incorreta!'}`);
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
                
                state.adminAuthenticated = false;
                
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        function loadAdminProducts() {
            const categoryContainers = {
                'drinks-whisky': 'adminWhiskyProducts',
                'drinks-gin': 'adminGinProducts',
                'drinks-vodka': 'adminVodkaProducts',
                'drinks-vinho': 'adminVinhoProducts',
                'cervejas': 'adminCervejaProducts',
                'destilados': 'adminDestiladoProducts',
                'aguas': 'adminAguaProducts',
                'refri-latas': 'adminRefriLataProducts',
                'refri-pet': 'adminRefriPetProducts',
                'sucos': 'adminSucoProducts',
                'energeticos': 'adminEnergeticoProducts',
                'gelo-carvao': 'adminGeloProducts'
            };

            Object.keys(categoryContainers).forEach(category => {
                const containerId = categoryContainers[category];
                const container = document.getElementById(containerId);
                if (!container) return;

                container.innerHTML = '';

                const categoryProducts = products[category] || [];
                categoryProducts.forEach(product => {
                    const isAvailable = isProductAvailable(product.id);

                    const productDiv = document.createElement('div');
                    productDiv.className = 'admin-product-item';
                    productDiv.innerHTML = `
                        <div>
                            <div class="admin-product-name">${product.name}</div>
                            <div class="admin-product-price">R$ ${product.price.toFixed(2)}</div>
                            ${product.requiresFlavorSelection ? '<small style="color: #60a5fa; font-size: 12px;">‚ö° Com sele√ß√£o de sabores</small>' : ''}
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" class="toggle-checkbox"
                                   id="admin_toggle_${product.id}"
                                   ${isAvailable ? 'checked' : ''}
                                   onchange="adminToggleProductAvailability('${product.id}', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    `;
                    container.appendChild(productDiv);
                });
            });
        }

        function adminToggleProductAvailability(productId, isAvailable) {
            state.productAvailability[productId] = isAvailable;

            const product = findProductById(productId);
            const productElements = document.querySelectorAll(`[data-product-id="${productId}"]`);

            productElements.forEach(element => {
                if (isAvailable) {
                    element.classList.remove('unavailable');
                    const button = element.querySelector('button');
                    if (button) {
                        button.disabled = false;
                        let buttonText = 'üõí Adicionar';
                        if (product && product.requiresFlavorSelection) buttonText = '‚ö° Escolher Sabores';
                        button.innerHTML = buttonText;
                    }
                } else {
                    element.classList.add('unavailable');
                    const button = element.querySelector('button');
                    if (button) {
                        button.disabled = true;
                        button.innerHTML = '‚ùå Indispon√≠vel';
                    }
                }
            });
        }

        function setAllAvailable(isAvailable) {
            Object.keys(products).forEach(category => {
                products[category].forEach(product => {
                    state.productAvailability[product.id] = isAvailable;

                    const toggle = document.getElementById(`admin_toggle_${product.id}`);
                    if (toggle) toggle.checked = isAvailable;

                    const productElements = document.querySelectorAll(`[data-product-id="${product.id}"]`);
                    productElements.forEach(element => {
                        if (isAvailable) {
                            element.classList.remove('unavailable');
                            const button = element.querySelector('button');
                            if (button) {
                                button.disabled = false;
                                let buttonText = 'üõí Adicionar';
                                if (product.requiresFlavorSelection) buttonText = '‚ö° Escolher Sabores';
                                button.innerHTML = buttonText;
                            }
                        } else {
                            element.classList.add('unavailable');
                            const button = element.querySelector('button');
                            if (button) {
                                button.disabled = true;
                                button.innerHTML = '‚ùå Indispon√≠vel';
                            }
                        }
                    });
                });
            });

            showNotification(isAvailable ? '‚úÖ Todos os produtos marcados como dispon√≠veis' : '‚ùå Todos os produtos marcados como indispon√≠veis');
        }

        // ============================================
        // FUN√á√ïES AUXILIARES DE SALVAMENTO
        // ============================================
        async function saveProductDataToBackend(productData) {
            try {
                const response = await fetch(`${CONFIG.backendUrl}/api/admin/product-availability/bulk`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-admin-password': CONFIG.adminPassword
                    },
                    body: JSON.stringify({
                        productAvailability: productData,
                        adminName: 'Admin BebCom',
                        source: 'sync_queue'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    return data.success === true;
                }
                return false;
            } catch (error) {
                console.error('‚ùå Erro ao salvar produto no backend:', error);
                return false;
            }
        }

        async function saveFlavorDataToBackend(flavorData) {
            try {
                const response = await fetch(`${CONFIG.backendUrl}/api/admin/flavor-availability/bulk`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-admin-password': CONFIG.adminPassword
                    },
                    body: JSON.stringify({
                        flavorAvailability: flavorData,
                        adminName: 'Admin BebCom',
                        source: 'sync_queue'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    return data.success === true;
                }
                return false;
            } catch (error) {
                console.error('‚ùå Erro ao salvar sabor no backend:', error);
                return false;
            }
        }

        // ============================================
        // FUN√á√ÉO PRINCIPAL DE SINCRONIZA√á√ÉO DE DADOS PENDENTES
        // ============================================
        async function syncPendingData() {
            const queue = getSyncQueue();
            
            // Se n√£o h√° dados pendentes, retornar
            if (queue.pendingProducts.length === 0 && queue.pendingFlavors.length === 0) {
                return { success: true, message: 'Nenhum dado pendente' };
            }
            
            console.log(`üîÑ Sincronizando ${queue.pendingProducts.length} produtos e ${queue.pendingFlavors.length} sabores pendentes...`);
            
            let successCount = 0;
            let errorCount = 0;
            
            // Tentar sincronizar produtos pendentes
            for (let i = queue.pendingProducts.length - 1; i >= 0; i--) {
                const item = queue.pendingProducts[i];
                
                try {
                    const saved = await saveProductDataToBackend(item.data);
                    if (saved) {
                        removeFromSyncQueue('products', item.data);
                        successCount++;
                        console.log(`‚úÖ Produto sincronizado: ${Object.keys(item.data).length} itens`);
                    } else {
                        item.attempts = (item.attempts || 0) + 1;
                        errorCount++;
                        
                        // Se tentou muitas vezes, remover da fila (evitar ficar preso)
                        if (item.attempts > 5) {
                            console.log(`‚ö†Ô∏è Removendo produto ap√≥s ${item.attempts} tentativas falhas`);
                            removeFromSyncQueue('products', item.data);
                        }
                    }
                } catch (error) {
                    console.error('‚ùå Erro ao sincronizar produto:', error);
                    item.attempts = (item.attempts || 0) + 1;
                    errorCount++;
                }
            }
            
            // Tentar sincronizar sabores pendentes
            for (let i = queue.pendingFlavors.length - 1; i >= 0; i--) {
                const item = queue.pendingFlavors[i];
                
                try {
                    const saved = await saveFlavorDataToBackend(item.data);
                    if (saved) {
                        removeFromSyncQueue('flavors', item.data);
                        successCount++;
                        console.log(`‚úÖ Sabor sincronizado: ${Object.keys(item.data).length} itens`);
                    } else {
                        item.attempts = (item.attempts || 0) + 1;
                        errorCount++;
                        
                        if (item.attempts > 5) {
                            console.log(`‚ö†Ô∏è Removendo sabor ap√≥s ${item.attempts} tentativas falhas`);
                            removeFromSyncQueue('flavors', item.data);
                        }
                    }
                } catch (error) {
                    console.error('‚ùå Erro ao sincronizar sabor:', error);
                    item.attempts = (item.attempts || 0) + 1;
                    errorCount++;
                }
            }
            
            // Atualizar fila
            saveSyncQueue(queue);
            
            // Mostrar notifica√ß√£o se sincronizou algo
            if (successCount > 0) {
                showNotification(`‚úÖ ${successCount} ${successCount === 1 ? 'item' : 'itens'} sincronizado(s) com sucesso!`);
                
                // Atualizar interface se ainda estiver no admin
                if (document.getElementById('adminModal').style.display === 'block') {
                    updateMenuAvailability();
                }
            }
            
            return {
                success: successCount > 0,
                synced: successCount,
                failed: errorCount,
                stillPending: queue.pendingProducts.length + queue.pendingFlavors.length
            };
        }

        // ============================================
        // MODIFICA√á√ÉO DA FUN√á√ÉO saveAvailability()
        // ============================================
        async function saveAvailability() {
            const saveButton = document.querySelector('.admin-action-btn.save-btn');
            const originalText = saveButton.innerHTML;

            saveButton.innerHTML = '<span class="loading-spinner"></span> Salvando...';
            saveButton.disabled = true;

            try {
                // 1. PRIMEIRO: Tentar salvar no backend
                const productsSaved = await saveProductDataToBackend(state.productAvailability);
                const flavorsSaved = await saveFlavorDataToBackend(state.flavorAvailability);

                if (productsSaved && flavorsSaved) {
                    // SUCESSO TOTAL: Dados salvos no MongoDB
                    showNotification('‚úÖ Todas as altera√ß√µes salvas para todos os usu√°rios!');
                    
                    // 2. Atualizar interface
                    updateMenuAvailability();
                    
                    // 3. Limpar fila de sincroniza√ß√£o (se houver)
                    const queue = getSyncQueue();
                    queue.pendingProducts = [];
                    queue.pendingFlavors = [];
                    queue.retryCount = 0;
                    saveSyncQueue(queue);
                    
                    // 4. Fechar modal ap√≥s 1.5 segundos
                    setTimeout(() => {
                        closeAdminPanel();
                    }, 1500);

                    return true;
                } else {
                    // FALHA PARCIAL OU TOTAL: Salvar localmente E na fila de sincroniza√ß√£o
                    const productData = state.productAvailability;
                    const flavorData = state.flavorAvailability;
                    
                    // Salvar no localStorage (fallback)
                    localStorage.setItem('bebcom_product_availability', JSON.stringify(productData));
                    localStorage.setItem('bebcom_flavor_availability', JSON.stringify(flavorData));
                    
                    // Adicionar √† fila de sincroniza√ß√£o
                    addToSyncQueue('products', productData);
                    addToSyncQueue('flavors', flavorData);
                    
                    showNotification('‚ö†Ô∏è Altera√ß√µes salvas localmente. Sincroniza√ß√£o pendente com o servidor.', 'warning');
                    
                    // Iniciar tentativas de sincroniza√ß√£o autom√°tica
                    startAutoSyncRetry();
                    
                    return false;
                }
            } catch (error) {
                console.error('Erro:', error);
                
                // FALHA TOTAL: Salvar apenas localmente e na fila
                const productData = state.productAvailability;
                const flavorData = state.flavorAvailability;
                
                localStorage.setItem('bebcom_product_availability', JSON.stringify(productData));
                localStorage.setItem('bebcom_flavor_availability', JSON.stringify(flavorData));
                
                addToSyncQueue('products', productData);
                addToSyncQueue('flavors', flavorData);
                
                showNotification('‚ùå Erro ao salvar. Dados salvos localmente e aguardando sincroniza√ß√£o.', 'error');
                
                startAutoSyncRetry();
                
                return false;
            } finally {
                saveButton.innerHTML = originalText;
                saveButton.disabled = false;
            }
        }

        function resetAvailability() {
            if (confirm('Restaurar todos os produtos como dispon√≠veis? Isso tamb√©m apagar√° as configura√ß√µes do servidor.')) {
                // Resetar localmente
                Object.keys(products).forEach(category => {
                    products[category].forEach(product => {
                        state.productAvailability[product.id] = true;
                    });
                });

                // Resetar sabores
                Object.keys(FLAVOR_CATALOG).forEach(flavorType => {
                    FLAVOR_CATALOG[flavorType].forEach(flavor => {
                        const key = `${flavorType}_${flavor}`;
                        state.flavorAvailability[key] = true;
                    });
                });

                // Salvar no backend
                saveAvailability();

                // Atualizar interface
                loadAdminProducts();
                updateMenuAvailability();

                showNotification('üîÑ Disponibilidade restaurada para o padr√£o', 'info');
            }
        }

        // ============================================
        // GERENCIAMENTO DE SABORES
        // ============================================
        function openFlavorManagement() {
            const adminMain = document.getElementById('adminMain');
            const adminActions = document.getElementById('adminActions');

            adminActions.style.display = 'none';

            adminMain.innerHTML = `
                <div style="margin-bottom: 30px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
                        <button onclick="loadAdminProducts(); document.getElementById('adminActions').style.display='block';"
                                style="background: #3b82f6; color: white; border: none; border-radius: 8px; padding: 10px 15px; cursor: pointer;">
                            ‚Ü©Ô∏è Voltar
                        </button>
                        <h3 style="color: #60a5fa; margin: 0; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; flex: 1;">
                            üçπ Gerenciamento de Sabores por Tipo
                        </h3>
                    </div>

                    <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                        <p style="color: #94a3b8; margin-bottom: 15px; font-size: 14px;">
                            <strong>Instru√ß√µes:</strong> Selecione um tipo de produto para gerenciar a disponibilidade dos sabores.
                        </p>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <label style="color: #ddd; display: block; margin-bottom: 8px; font-weight: bold;">
                            Selecione o tipo de produto:
                        </label>
                        <select id="flavorTypeSelect" class="form-input" style="width: 100%; padding: 12px; margin-bottom: 20px;"
                                onchange="loadFlavorsForType(this.value)">
                            <option value="">-- Selecione um tipo de produto --</option>
                            ${Object.entries(FLAVOR_TYPES).map(([key, name]) =>
                                `<option value="${key}">${name}</option>`
                            ).join('')}
                        </select>
                    </div>

                    <div id="flavorManagementSection" style="display: none;">
                        <h4 style="color: #94a3b8; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #444;"
                            id="flavorTypeTitle"></h4>

                        <div id="flavorsList" style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                            <!-- Lista de sabores ser√° gerada aqui -->
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button class="modal-button confirm" onclick="saveFlavorChanges()" style="flex: 1;">
                                üíæ Salvar Altera√ß√µes
                            </button>
                            <button class="modal-button cancel" onclick="loadFlavorsForType('')" style="flex: 1;">
                                üîÑ Limpar Sele√ß√£o
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadFlavorsForType(flavorType) {
            const section = document.getElementById('flavorManagementSection');
            const title = document.getElementById('flavorTypeTitle');
            const list = document.getElementById('flavorsList');

            if (!flavorType) {
                section.style.display = 'none';
                return;
            }

            const flavors = FLAVOR_CATALOG[flavorType] || [];
            const flavorTypeName = FLAVOR_TYPES[flavorType] || flavorType;

            if (flavors.length === 0) {
                title.textContent = `Nenhum sabor cadastrado para ${flavorTypeName}`;
                list.innerHTML = `
                    <div style="text-align: center; color: #aaa; padding: 40px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üòï</div>
                        <p>N√£o h√° sabores cadastrados para este tipo de produto.</p>
                    </div>
                `;
                section.style.display = 'block';
                return;
            }

            title.textContent = `Gerenciando sabores de ${flavorTypeName} (${flavors.length} sabores)`;

            // Contar sabores dispon√≠veis
            const availableCount = flavors.filter(flavor =>
                isFlavorAvailable(flavorType, flavor)
            ).length;

            list.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;">
                    <span style="color: #f5f5f5;">
                        <strong>Status:</strong> ${availableCount} de ${flavors.length} sabores dispon√≠veis
                    </span>
                    <div>
                        <button onclick="setAllFlavorsAvailable('${flavorType}', true)"
                                style="background: #10b981; color: white; border: none; border-radius: 6px; padding: 6px 12px; margin-right: 5px; cursor: pointer; font-size: 12px;">
                            ‚úÖ Todos
                        </button>
                        <button onclick="setAllFlavorsAvailable('${flavorType}', false)"
                                style="background: #ef4444; color: white; border: none; border-radius: 6px; padding: 6px 12px; cursor: pointer; font-size: 12px;">
                            ‚ùå Nenhum
                        </button>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px;">
                    ${flavors.map((flavor, index) => {
                        const isAvailable = isFlavorAvailable(flavorType, flavor);
                        return `
                            <div style="display: flex; justify-content: space-between; align-items: center;
                                        padding: 15px; background: ${isAvailable ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)'};
                                        border-radius: 8px; border: 1px solid ${isAvailable ? '#10b981' : '#ef4444'};">
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                        <span style="font-size: 20px;">${isAvailable ? '‚úÖ' : '‚ùå'}</span>
                                        <div>
                                            <span style="color: #f5f5f5; font-weight: 500; font-size: 16px;">${flavor}</span>
                                            <br>
                                            <small style="color: ${isAvailable ? '#10b981' : '#ef4444'}; font-size: 12px;">
                                                ${isAvailable ? 'Dispon√≠vel' : 'Indispon√≠vel'}
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" class="toggle-checkbox flavor-toggle"
                                           data-flavor-type="${flavorType}"
                                           data-flavor-name="${flavor}"
                                           ${isAvailable ? 'checked' : ''}
                                           onchange="toggleFlavorAvailability('${flavorType}', '${flavor}', this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            section.style.display = 'block';
        }

        function toggleFlavorAvailability(flavorType, flavorName, isAvailable) {
            const key = `${flavorType}_${flavorName}`;
            state.flavorAvailability[key] = isAvailable;

            showNotification(`${flavorName} ${isAvailable ? '‚úÖ dispon√≠vel' : '‚ùå indispon√≠vel'}`,
                            isAvailable ? 'success' : 'error');
        }

        function setAllFlavorsAvailable(flavorType, makeAvailable) {
            const flavors = FLAVOR_CATALOG[flavorType] || [];

            flavors.forEach(flavor => {
                const key = `${flavorType}_${flavor}`;
                state.flavorAvailability[key] = makeAvailable;
            });

            // Recarregar a lista
            loadFlavorsForType(flavorType);

            showNotification(`${makeAvailable ? '‚úÖ Todos os sabores dispon√≠veis' : '‚ùå Todos os sabores indispon√≠veis'}`,
                            makeAvailable ? 'success' : 'warning');
        }

        async function saveFlavorChanges() {
            const saved = await saveFlavorDataToBackend(state.flavorAvailability);

            if (saved) {
                showNotification('‚úÖ Disponibilidade de sabores salva com sucesso!');
            } else {
                showNotification('‚ö†Ô∏è Altera√ß√µes salvas apenas localmente', 'warning');
                localStorage.setItem('bebcom_flavor_availability', JSON.stringify(state.flavorAvailability));
                addToSyncQueue('flavors', state.flavorAvailability);
                startAutoSyncRetry();
            }
        }

        // ============================================
        // MODIFICA√á√ÉO DA FUN√á√ÉO syncAllFromServer()
        // ============================================
        async function syncAllFromServer() {
            const syncButton = document.querySelector('.admin-action-btn:nth-child(7)') || 
                              document.querySelector('.admin-action-btn[onclick*="syncAllFromServer"]');
            
            if (!syncButton) {
                console.error('Bot√£o de sincroniza√ß√£o n√£o encontrado');
                return;
            }
            
            const originalText = syncButton.innerHTML;
            const isManualSync = syncButton.textContent.includes('Sincronizar');

            syncButton.innerHTML = '<span class="loading-spinner"></span> Sincronizando...';
            syncButton.disabled = true;

            try {
                // 1. PRIMEIRO: Tentar sincronizar dados pendentes (se houver)
                let pendingSyncResult = { synced: 0 };
                
                if (hasPendingSync()) {
                    console.log('üì§ Enviando dados pendentes primeiro...');
                    pendingSyncResult = await syncPendingData();
                    
                    if (pendingSyncResult.synced > 0) {
                        showNotification(`‚úÖ ${pendingSyncResult.synced} dados pendentes sincronizados primeiro`);
                    }
                }
                
                // 2. DEPOIS: Buscar dados atualizados do servidor
                console.log('üì• Buscando dados do servidor...');
                const response = await fetch(`${CONFIG.backendUrl}/api/sync-all`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.success) {
                        // Atualizar dados locais com os do servidor
                        if (data.productAvailability) {
                            state.productAvailability = data.productAvailability;
                            localStorage.setItem('bebcom_product_availability', JSON.stringify(data.productAvailability));
                        }
                        
                        if (data.flavorAvailability) {
                            state.flavorAvailability = data.flavorAvailability;
                            localStorage.setItem('bebcom_flavor_availability', JSON.stringify(data.flavorAvailability));
                        }
                        
                        // Atualizar interface
                        updateMenuAvailability();
                        
                        if (document.getElementById('adminModal').style.display === 'block') {
                            loadAdminProducts();
                        }
                        
                        const message = pendingSyncResult.synced > 0 
                            ? `üîÑ ${pendingSyncResult.synced} dados enviados e recebidos do servidor`
                            : 'üîÑ Todos os dados sincronizados do servidor';
                        
                        showNotification(message, 'success');
                        
                    } else {
                        throw new Error('Falha na sincroniza√ß√£o');
                    }
                } else {
                    throw new Error('Falha na resposta do servidor');
                }
                
            } catch (error) {
                console.error('‚ùå Erro na sincroniza√ß√£o:', error);
                
                // Se for sincroniza√ß√£o MANUAL, mostrar erro
                if (isManualSync) {
                    showNotification('‚ö†Ô∏è Falha na sincroniza√ß√£o. Dados locais mantidos.', 'warning');
                }
                // Se for autom√°tica, s√≥ logar
            } finally {
                syncButton.innerHTML = originalText;
                syncButton.disabled = false;
            }
        }

        function setupAutoSync() {
            // Sincronizar imediatamente ao carregar
            setTimeout(() => {
                if (state.ageVerified && !state.adminAuthenticated) {
                    syncAllFromServer();
                }
            }, 3000);

            // Sincronizar a cada 5 minutos
            setInterval(() => {
                if (state.ageVerified && !state.adminAuthenticated) {
                    syncAllFromServer();
                }
            }, 5 * 60 * 1000);
        }

        function updateMenuAvailability() {
            Object.keys(products).forEach(category => {
                products[category].forEach(product => {
                    const productElements = document.querySelectorAll(`[data-product-id="${product.id}"]`);
                    const isAvailable = isProductAvailable(product.id);
                    const hasFlavors = product.requiresFlavorSelection || false;

                    productElements.forEach(element => {
                        if (isAvailable) {
                            element.classList.remove('unavailable');
                            const button = element.querySelector('button');
                            if (button) {
                                button.disabled = false;
                                let buttonText = 'üõí Adicionar';
                                if (hasFlavors) buttonText = '‚ö° Escolher Sabores';
                                button.innerHTML = buttonText;

                                if (hasFlavors) {
                                    button.classList.add('has-flavors');
                                    element.classList.add('with-flavors');
                                    if (!element.querySelector('.flavor-badge')) {
                                        const badge = document.createElement('div');
                                        badge.className = 'flavor-badge';
                                        badge.textContent = '‚ö°';
                                        element.insertBefore(badge, element.firstChild);
                                    }
                                } else {
                                    button.classList.remove('has-flavors');
                                    element.classList.remove('with-flavors');
                                    const badge = element.querySelector('.flavor-badge');
                                    if (badge) badge.remove();
                                }
                            }
                        } else {
                            element.classList.add('unavailable');
                            const button = element.querySelector('button');
                            if (button) {
                                button.disabled = true;
                                button.innerHTML = '‚ùå Indispon√≠vel';
                            }
                        }
                    });
                });
            });
        }

        // ============================================
        // FUN√á√ïES DE STATUS
        // ============================================
        function showSyncStatus() {
            const queue = getSyncQueue();
            const pendingProducts = queue.pendingProducts.length;
            const pendingFlavors = queue.pendingFlavors.length;
            
            let statusMessage = '';
            
            if (pendingProducts === 0 && pendingFlavors === 0) {
                statusMessage = '‚úÖ Todos os dados est√£o sincronizados com o servidor.';
            } else {
                statusMessage = `‚ö†Ô∏è H√° dados pendentes de sincroniza√ß√£o:\n`;
                statusMessage += `‚Ä¢ ${pendingProducts} altera√ß√£o(√µes) de produtos\n`;
                statusMessage += `‚Ä¢ ${pendingFlavors} altera√ß√£o(√µes) de sabores\n\n`;
                statusMessage += `Clique em "Sincronizar Agora" para tentar novamente.`;
            }
            
            alert(statusMessage);
        }

        async function showBackendStatus() {
            try {
                const response = await fetch(`${CONFIG.backendUrl}/health-full`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    const queue = getSyncQueue();
                    const pendingProducts = queue.pendingProducts.length;
                    const pendingFlavors = queue.pendingFlavors.length;
                    
                    let statusMessage = `üìä STATUS DO BACKEND\n`;
                    statusMessage += `====================\n`;
                    statusMessage += `‚úÖ Status: ONLINE\n`;
                    statusMessage += `üïí Uptime: ${Math.floor(data.uptime / 60)} minutos\n`;
                    statusMessage += `üóÑÔ∏è  MongoDB: ${data.dbConnected ? 'CONECTADO' : 'DESCONECTADO'}\n`;
                    statusMessage += `üåê Ambiente: ${data.environment}\n`;
                    statusMessage += `\nüì¶ FILA DE SINCRONIZA√á√ÉO:\n`;
                    
                    if (pendingProducts === 0 && pendingFlavors === 0) {
                        statusMessage += `‚úÖ Nenhum dado pendente\n`;
                    } else {
                        statusMessage += `‚ö†Ô∏è ${pendingProducts} altera√ß√£o(√µes) de produtos\n`;
                        statusMessage += `‚ö†Ô∏è ${pendingFlavors} altera√ß√£o(√µes) de sabores\n`;
                    }
                    
                    alert(statusMessage);
                } else {
                    throw new Error('Backend offline');
                }
            } catch (error) {
                const queue = getSyncQueue();
                const pendingProducts = queue.pendingProducts.length;
                const pendingFlavors = queue.pendingFlavors.length;
                
                let statusMessage = `üìä STATUS DO BACKEND\n`;
                statusMessage += `====================\n`;
                statusMessage += `‚ùå Status: OFFLINE\n`;
                statusMessage += `üîÑ Modo: LOCAL\n`;
                
                if (backendOfflineSince) {
                    const offlineSeconds = Math.round((Date.now() - backendOfflineSince) / 1000);
                    statusMessage += `‚è±Ô∏è  Offline h√°: ${offlineSeconds} segundos\n`;
                }
                
                statusMessage += `\nüì¶ FILA DE SINCRONIZA√á√ÉO:\n`;
                
                if (pendingProducts === 0 && pendingFlavors === 0) {
                    statusMessage += `‚úÖ Nenhum dado pendente\n`;
                } else {
                    statusMessage += `‚ö†Ô∏è ${pendingProducts} altera√ß√£o(√µes) de produtos\n`;
                    statusMessage += `‚ö†Ô∏è ${pendingFlavors} altera√ß√£o(√µes) de sabores\n`;
                    statusMessage += `\nüí° Dica: Clique em "Sincronizar Agora" quando o backend voltar`;
                }
                
                alert(statusMessage);
            }
        }

        // ============================================
        // FUN√á√ïES UTILIT√ÅRIAS
        // ============================================
        function showNotification(text, type = 'success') {
            const notification = document.createElement('div');
            const colors = {
                success: 'linear-gradient(135deg, #28a745 0%, #218838 100%)',
                error: 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)',
                warning: 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)',
                info: 'linear-gradient(135deg, #17a2b8 0%, #138496 100%)'
            };

            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.success};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideIn 0.3s ease;
                font-weight: bold;
                min-width: 300px;
                max-width: 400px;
                word-break: break-word;
            `;

            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">
                        ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
                    </span>
                    <span>${text}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        function setupEventListeners() {
            document.getElementById('customerName').addEventListener('input', validateForm);
            document.getElementById('customerPhone').addEventListener('input', validateForm);
            document.getElementById('street').addEventListener('input', validateForm);
            document.getElementById('number').addEventListener('input', validateForm);
            document.getElementById('neighborhood').addEventListener('input', validateForm);
            document.getElementById('city').addEventListener('input', validateForm);
        }

        function setupPhoneMask() {
            const phoneInput = document.getElementById('customerPhone');
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');

                if (value.length > 11) value = value.substring(0, 11);

                if (value.length > 0) {
                    value = '(' + value.substring(0, 2) + ') ' + value.substring(2);
                }

                if (value.length > 9) {
                    value = value.substring(0, 10) + '-' + value.substring(10);
                }

                e.target.value = value;
                validateForm();
            });
        }

        function setupAutoSave() {
            // Salvar ao fechar a p√°gina
            window.addEventListener('beforeunload', function(e) {
                if (state.cart.length > 0) {
                    saveCartToLocalStorage();
                }
            });
        }

        function exportOrder() {
            const orderData = {
                cart: state.cart,
                customer: {
                    name: document.getElementById('customerName').value,
                    phone: document.getElementById('customerPhone').value
                },
                deliveryType: state.deliveryType,
                total: getCartTotal(),
                timestamp: new Date().toISOString()
            };

            const dataStr = JSON.stringify(orderData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportFileDefaultName = `pedido_bebcom_${Date.now()}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();

            showNotification('üìÅ Pedido exportado com sucesso', 'info');
        }

        function getCartTotal() {
            return state.cart.reduce((total, item) => {
                return total + (item.price * item.quantity);
            }, 0);
        }

        // ============================================
        // INICIALIZA√á√ÉO PRINCIPAL
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM carregado, inicializando sistemas...');
            
            // Inicializar sistema administrativo INDEPENDENTE da idade
            initAdminSystem();
            
            // Inicializar verifica√ß√£o de idade (para usu√°rios normais)
            initAgeVerification();
            
            // Testar conex√£o com backend
            setTimeout(async () => {
                try {
                    const response = await fetch(`${CONFIG.backendUrl}/health`);
                    if (response.ok) {
                        console.log('‚úÖ Backend online');
                    } else {
                        console.warn('‚ö†Ô∏è  Backend offline ou lento');
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è  N√£o foi poss√≠vel conectar ao backend');
                }
            }, 2000);
        });
    </script>
</body>
</html>
